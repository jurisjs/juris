<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris 0.91.0 - SmartList Demo</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .version-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .demo-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e0e7ff;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
        }

        .demo-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-section h2::before {
            content: "üöÄ";
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn.danger:hover {
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        input, select {
            padding: 10px 15px;
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .smart-list {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
            min-height: 200px;
        }

        .todo-item {
            background: white;
            border: 2px solid #e0e7ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .todo-item:hover {
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .todo-item.completed {
            opacity: 0.7;
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }

        .todo-item.completed .todo-title {
            text-decoration: line-through;
        }

        .todo-item.high-priority {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
        }

        .todo-item::after {
            content: attr(data-key);
            position: absolute;
            top: 2px;
            right: 8px;
            font-size: 10px;
            color: #999;
            font-family: monospace;
        }

        .todo-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        .todo-content {
            flex: 1;
        }

        .todo-title {
            font-weight: 600;
            color: #333;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .todo-meta {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #666;
        }

        .priority-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high { background: #fee2e2; color: #dc2626; }
        .priority-medium { background: #fef3c7; color: #d97706; }
        .priority-low { background: #e0f2fe; color: #0284c7; }

        .category-badge {
            background: #f3e8ff;
            color: #7c3aed;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .todo-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
            border: 2px solid #e0e7ff;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state::before {
            content: "üìù";
            font-size: 3rem;
            display: block;
            margin-bottom: 10px;
        }

        .performance-info {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-line;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .perf-item {
            background: white;
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
        }

        .perf-item:hover {
            border-color: #667eea;
            transform: translateX(2px);
        }

        .perf-item-color {
            width: 4px;
            height: 30px;
            border-radius: 2px;
        }

        .perf-item-content {
            flex: 1;
        }

        .perf-item-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .perf-item-meta {
            font-size: 12px;
            color: #666;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateX(-20px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }

        .todo-item {
            animation: slideIn 0.3s ease;
        }

        .smart-diff-badge {
            position: absolute;
            top: -8px;
            left: 10px;
            background: #10b981;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }
            position: absolute;
            top: -8px;
            left: 10px;
            background: #10b981;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <!-- Load the actual Juris framework -->
    <script src="../src/juris.js"></script>
    
    <script>
        // SmartList Component for Juris 0.91.0 (from our compatible version)
        function SmartList(props, context) {
            const { items, renderItem, keyFn = (item, index) => index, placeholder } = props;
            
            return {
                div: {
                    class: props.class || 'smart-list',
                    style: { position: 'relative' },
                    children: [
                        { div: { class: 'smart-diff-badge', text: 'Smart Diff' } },
                        (parentElement) => {
                            const currentItems = typeof items === 'function' ? items() : items;
                            
                            if (!currentItems || currentItems.length === 0) {
                                if (placeholder) {
                                    parentElement.innerHTML = '';
                                    const placeholderEl = context.juris.domRenderer.render(placeholder);
                                    if (placeholderEl) parentElement.appendChild(placeholderEl);
                                } else {
                                    parentElement.innerHTML = '';
                                }
                                return null;
                            }
                            
                            return smartDiff(parentElement, currentItems, renderItem, keyFn, context);
                        }
                    ]
                }
            };
        }

        function smartDiff(parentElement, newItems, renderItem, keyFn, context) {
            const existingNodes = Array.from(parentElement.children);
            
            // If no existing nodes, do initial render
            if (existingNodes.length === 0) {
                return initialRender(parentElement, newItems, renderItem, keyFn, context);
            }
            
            // Build maps for existing nodes
            const existingNodeMap = new Map();
            const existingItemDataMap = new Map();
            
            existingNodes.forEach(node => {
                const key = node.dataset.jurisKey;
                if (key) {
                    existingNodeMap.set(key, node);
                    if (node._jurisItemData) {
                        existingItemDataMap.set(key, node._jurisItemData);
                    }
                }
            });
            
            // Create new items key map
            const newKeys = newItems.map((item, index) => String(keyFn(item, index)));
            
            // Track operations needed
            const operations = [];
            const usedNodes = new Set();
            
            // Plan all operations first
            newItems.forEach((item, index) => {
                const key = String(keyFn(item, index));
                const existingNode = existingNodeMap.get(key);
                
                if (existingNode) {
                    // Node exists - check if update needed
                    const oldData = existingItemDataMap.get(key);
                    const needsUpdate = shouldUpdateItem(oldData, { item, index });
                    
                    operations.push({
                        type: 'reuse',
                        key,
                        item,
                        index,
                        node: existingNode,
                        needsUpdate
                    });
                    usedNodes.add(existingNode);
                } else {
                    // New node needed
                    operations.push({
                        type: 'create',
                        key,
                        item,
                        index
                    });
                }
            });
            
            // Remove unused nodes
            existingNodes.forEach(node => {
                if (!usedNodes.has(node)) {
                    cleanupNode(node, context);
                    node.remove();
                }
            });
            
            // Execute operations to build final order
            const finalNodes = [];
            
            operations.forEach(op => {
                if (op.type === 'reuse') {
                    if (op.needsUpdate) {
                        updateItemElementInPlace(op.node, op.item, op.index, renderItem, context);
                    }
                    finalNodes.push(op.node);
                } else if (op.type === 'create') {
                    const newNode = createItemElement(op.item, op.index, renderItem, op.key, context);
                    if (newNode) {
                        finalNodes.push(newNode);
                    }
                }
            });
            
            // Apply the new order efficiently
            applyOrder(parentElement, finalNodes);
            
            return null;
        }

        function applyOrder(parentElement, finalNodes) {
            const currentNodes = Array.from(parentElement.children);
            
            // Check if order is already correct
            let orderCorrect = currentNodes.length === finalNodes.length;
            if (orderCorrect) {
                for (let i = 0; i < currentNodes.length; i++) {
                    if (currentNodes[i] !== finalNodes[i]) {
                        orderCorrect = false;
                        break;
                    }
                }
            }
            
            if (orderCorrect) {
                return; // No DOM manipulation needed
            }
            
            // Apply minimal DOM changes to achieve correct order
            finalNodes.forEach((node, targetIndex) => {
                const currentIndex = Array.from(parentElement.children).indexOf(node);
                
                if (currentIndex !== targetIndex) {
                    if (targetIndex >= parentElement.children.length) {
                        // Append to end
                        parentElement.appendChild(node);
                    } else {
                        // Insert before target position
                        const referenceNode = parentElement.children[targetIndex];
                        parentElement.insertBefore(node, referenceNode);
                    }
                }
            });
        }

        function updateItemElementInPlace(element, newItem, newIndex, renderItem, context) {
            // Update the stored data
            element._jurisItemData = { 
                item: deepClone(newItem), 
                index: newIndex,
                hash: generateHash(newItem)
            };
            
            // Update visual key indicator
            element.setAttribute('data-key', newItem.id);
            
            // For true granular updates, we need to selectively update only changed parts
            updateItemGranularly(element, newItem, newIndex, context);
        }

        function updateItemGranularly(element, newItem, newIndex, context) {
            // Update checkbox state
            const checkbox = element.querySelector('.todo-checkbox');
            if (checkbox && checkbox.checked !== newItem.completed) {
                checkbox.checked = newItem.completed;
            }
            
            // Update CSS classes based on item state
            const currentClasses = element.className;
            const shouldHaveCompleted = newItem.completed;
            const shouldHaveHighPriority = newItem.priority === 'high';
            
            if (shouldHaveCompleted && !currentClasses.includes('completed')) {
                element.classList.add('completed');
            } else if (!shouldHaveCompleted && currentClasses.includes('completed')) {
                element.classList.remove('completed');
            }
            
            if (shouldHaveHighPriority && !currentClasses.includes('high-priority')) {
                element.classList.add('high-priority');
            } else if (!shouldHaveHighPriority && currentClasses.includes('high-priority')) {
                element.classList.remove('high-priority');
            }
            
            // Update title text
            const titleEl = element.querySelector('.todo-title');
            if (titleEl && titleEl.textContent !== newItem.title) {
                titleEl.textContent = newItem.title;
            }
            
            // Update priority badge
            const priorityBadge = element.querySelector('.priority-badge');
            if (priorityBadge) {
                const newPriorityClass = `priority-badge priority-${newItem.priority}`;
                if (priorityBadge.className !== newPriorityClass) {
                    priorityBadge.className = newPriorityClass;
                    priorityBadge.textContent = newItem.priority;
                }
            }
            
            // Update category badge
            const categoryBadge = element.querySelector('.category-badge');
            if (categoryBadge && categoryBadge.textContent !== newItem.category) {
                categoryBadge.textContent = newItem.category;
            }
            
            // Update timestamp
            const timestampEl = element.querySelector('.todo-meta span:last-child');
            const expectedTimestamp = `Created: ${newItem.created}`;
            if (timestampEl && timestampEl.textContent !== expectedTimestamp) {
                timestampEl.textContent = expectedTimestamp;
            }
            
            // DON'T UPDATE REACTIVE ELEMENTS - They manage themselves!
            // The reactive counter, timer, animations, live data etc. are managed 
            // by Juris's reactive system and will update automatically when their 
            // state paths change. This is the key benefit - we only update the 
            // item-specific data, not the reactive deep nested elements.
            
            // Performance items have different structure
            if (element.classList.contains('perf-item')) {
                updatePerformanceItemGranularly(element, newItem);
            }
        }
        
        function updatePerformanceItemGranularly(element, newItem) {
            // Update color bar
            const colorBar = element.querySelector('.perf-item-color');
            if (colorBar) {
                const newColor = `hsl(${newItem.hue}, 70%, 50%)`;
                if (colorBar.style.backgroundColor !== newColor) {
                    colorBar.style.backgroundColor = newColor;
                }
            }
            
            // Update title
            const titleEl = element.querySelector('.perf-item-title');
            const expectedTitle = `Item ${newItem.id}`;
            if (titleEl && titleEl.textContent !== expectedTitle) {
                titleEl.textContent = expectedTitle;
            }
            
            // Update meta info
            const metaEl = element.querySelector('.perf-item-meta');
            const expectedMeta = `Value: ${newItem.value} | Updated: ${newItem.lastUpdate}`;
            if (metaEl && metaEl.textContent !== expectedMeta) {
                metaEl.textContent = expectedMeta;
            }
        }

        function initialRender(parentElement, newItems, renderItem, keyFn, context) {
            const fragment = document.createDocumentFragment();
            
            newItems.forEach((item, index) => {
                const key = String(keyFn(item, index));
                const element = createItemElement(item, index, renderItem, key, context);
                if (element) fragment.appendChild(element);
            });
            
            parentElement.appendChild(fragment);
            return null;
        }

        function shouldUpdateItem(oldData, newData) {
            if (!oldData) return true;
            
            // Quick hash comparison first
            const newHash = generateHash(newData.item);
            if (oldData.hash && oldData.hash === newHash && oldData.index === newData.index) {
                return false;
            }
            
            // Fallback to deep comparison
            return oldData.index !== newData.index || !deepEquals(oldData.item, newData.item);
        }

        function createItemElement(item, index, renderItem, key, context) {
            const vnode = renderItem(item, index);
            const element = context.juris.domRenderer.render(vnode);
            
            if (element) {
                element.dataset.jurisKey = key;
                element.setAttribute('data-key', item.id || key);
                element._jurisItemData = { 
                    item: deepClone(item), 
                    index,
                    hash: generateHash(item)
                };
            }
            
            return element;
        }

        function cleanupNode(element, context) {
            try {
                // Use the simplified cleanup from 0.91.0
                if (context.juris.domRenderer.cleanup) {
                    context.juris.domRenderer.cleanup(element);
                }
            } catch (error) {
                // Fallback cleanup
                if (element._reactiveCleanup) {
                    try { 
                        element._reactiveCleanup(); 
                    } catch(e) {}
                    element._reactiveCleanup = null;
                }
            }
        }

        // Utility functions
        function deepClone(obj) {
            if (obj === null || typeof obj !== 'object') return obj;
            if (obj instanceof Date) return new Date(obj);
            if (Array.isArray(obj)) return obj.map(deepClone);
            
            const cloned = {};
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    cloned[key] = deepClone(obj[key]);
                }
            }
            return cloned;
        }

        function generateHash(obj) {
            return JSON.stringify(obj, Object.keys(obj).sort());
        }

        // Juris already provides deepEquals globally, no need to redeclare

        // Initialize Juris
        const juris = new Juris({
            states: {
                todos: [],
                performanceItems: [],
                stats: { total: 0, completed: 0, highPriority: 0 },
                performance: { lastOperation: '', duration: 0, itemCount: 0 },
                // Reactive states for deep nested elements
                timers: {},
                counters: {},
                liveData: {},
                animations: {}
            }
        });

        // Register SmartList component
        juris.registerComponent('SmartList', SmartList);

        // Helper functions
        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function updateStats() {
            const todos = juris.getState('todos', []);
            const total = todos.length;
            const completed = todos.filter(t => t.completed).length;
            const highPriority = todos.filter(t => t.priority === 'high').length;
            
            juris.setState('stats.total', total);
            juris.setState('stats.completed', completed);
            juris.setState('stats.highPriority', highPriority);
        }

        function measurePerformance(operation, fn) {
            const start = performance.now();
            const result = fn();
            const duration = performance.now() - start;
            
            juris.setState('performance.lastOperation', operation);
            juris.setState('performance.duration', Math.round(duration * 100) / 100);
            
            return result;
        }

        // Reactive helpers for deep nested elements
        function startItemTimer(itemId) {
            const timerPath = `timers.${itemId}`;
            if (juris.getState(timerPath) === null) {
                juris.setState(timerPath, 0);
                setInterval(() => {
                    const current = juris.getState(timerPath, 0);
                    juris.setState(timerPath, current + 1);
                }, 1000);
            }
        }

        function incrementCounter(itemId) {
            const counterPath = `counters.${itemId}`;
            const current = juris.getState(counterPath, 0);
            juris.setState(counterPath, current + 1);
        }

        function updateLiveData(itemId) {
            const liveDataPath = `liveData.${itemId}`;
            juris.setState(liveDataPath, {
                temperature: Math.floor(Math.random() * 100),
                status: ['active', 'idle', 'processing'][Math.floor(Math.random() * 3)],
                lastPing: new Date().toLocaleTimeString()
            });
        }

        function toggleAnimation(itemId) {
            const animPath = `animations.${itemId}`;
            const current = juris.getState(animPath, false);
            juris.setState(animPath, !current);
        }

        // Set up the main layout
        juris.layout = {
            div: {
                class: 'container',
                children: [
                    // Header
                    {
                        div: {
                            class: 'header',
                            children: [
                                { 
                                    h1: { 
                                        children: [
                                            'Juris Framework',
                                            { span: { class: 'version-badge', text: 'v0.91.0' } }
                                        ]
                                    }
                                },
                                { p: { text: 'Smart Diffing Demo - Optimized for 0.91.0' } }
                            ]
                        }
                    },
                    
                    // Main content
                    {
                        div: {
                            class: 'demo-grid',
                            children: [
                                // Todo List Demo
                                {
                                    div: {
                                        class: 'demo-section',
                                        children: [
                                            { h2: { text: 'Smart Todo List' } },
                                            
                                            // Add todo controls
                                            {
                                                div: {
                                                    class: 'controls',
                                                    children: [
                                                        {
                                                            div: {
                                                                class: 'input-group',
                                                                children: [
                                                                    { input: { type: 'text', id: 'todoTitle', placeholder: 'Enter todo title' } },
                                                                    {
                                                                        select: {
                                                                            id: 'todoPriority',
                                                                            children: [
                                                                                { option: { value: 'low', text: 'Low Priority' } },
                                                                                { option: { value: 'medium', text: 'Medium Priority' } },
                                                                                { option: { value: 'high', text: 'High Priority' } }
                                                                            ]
                                                                        }
                                                                    },
                                                                    {
                                                                        select: {
                                                                            id: 'todoCategory',
                                                                            children: [
                                                                                { option: { value: 'work', text: 'Work' } },
                                                                                { option: { value: 'personal', text: 'Personal' } },
                                                                                { option: { value: 'shopping', text: 'Shopping' } },
                                                                                { option: { value: 'health', text: 'Health' } }
                                                                            ]
                                                                        }
                                                                    },
                                                                    {
                                                                        button: {
                                                                            class: 'btn',
                                                                            text: 'Add Todo',
                                                                            onclick: () => {
                                                                                const titleEl = document.getElementById('todoTitle');
                                                                                const priorityEl = document.getElementById('todoPriority');
                                                                                const categoryEl = document.getElementById('todoCategory');
                                                                                
                                                                                if (titleEl.value.trim()) {
                                                                                    const newTodo = {
                                                                                        id: generateId(),
                                                                                        title: titleEl.value.trim(),
                                                                                        completed: false,
                                                                                        priority: priorityEl.value,
                                                                                        category: categoryEl.value,
                                                                                        created: new Date().toLocaleTimeString()
                                                                                    };
                                                                                    
                                                                                    measurePerformance('Add Todo', () => {
                                                                                        const todos = juris.getState('todos', []);
                                                                                        juris.setState('todos', [...todos, newTodo]);
                                                                                    });
                                                                                    
                                                                                    titleEl.value = '';
                                                                                    updateStats();
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            
                                            // Action controls
                                            {
                                                div: {
                                                    class: 'controls',
                                                    children: [
                                                        {
                                                            button: {
                                                                class: 'btn',
                                                                text: 'üîÄ Shuffle Order',
                                                                onclick: () => {
                                                                    measurePerformance('Shuffle Todos', () => {
                                                                        const todos = [...juris.getState('todos', [])];
                                                                        for (let i = todos.length - 1; i > 0; i--) {
                                                                            const j = Math.floor(Math.random() * (i + 1));
                                                                            [todos[i], todos[j]] = [todos[j], todos[i]];
                                                                        }
                                                                        juris.setState('todos', todos);
                                                                    });
                                                                }
                                                            }
                                                        },
                                                        {
                                                            button: {
                                                                class: 'btn',
                                                                text: '‚ûï Add 5 Random',
                                                                onclick: () => {
                                                                    measurePerformance('Add 5 Random', () => {
                                                                        const todos = juris.getState('todos', []);
                                                                        const priorities = ['low', 'medium', 'high'];
                                                                        const categories = ['work', 'personal', 'shopping', 'health'];
                                                                        const tasks = [
                                                                            'Review quarterly reports',
                                                                            'Call dentist appointment',
                                                                            'Buy groceries for dinner',
                                                                            'Exercise for 30 minutes',
                                                                            'Read industry news',
                                                                            'Update documentation',
                                                                            'Organize workspace',
                                                                            'Plan weekend activities'
                                                                        ];
                                                                        
                                                                        const newTodos = Array.from({length: 5}, () => ({
                                                                            id: generateId(),
                                                                            title: tasks[Math.floor(Math.random() * tasks.length)],
                                                                            completed: Math.random() < 0.3,
                                                                            priority: priorities[Math.floor(Math.random() * priorities.length)],
                                                                            category: categories[Math.floor(Math.random() * categories.length)],
                                                                            created: new Date().toLocaleTimeString()
                                                                        }));
                                                                        
                                                                        juris.setState('todos', [...todos, ...newTodos]);
                                                                    });
                                                                    updateStats();
                                                                }
                                                            }
                                                        },
                                                        {
                                                            button: {
                                                                class: 'btn danger',
                                                                text: 'üóëÔ∏è Clear Completed',
                                                                onclick: () => {
                                                                    measurePerformance('Clear Completed', () => {
                                                                        const todos = juris.getState('todos', []);
                                                                        const remaining = todos.filter(t => !t.completed);
                                                                        juris.setState('todos', remaining);
                                                                    });
                                                                    updateStats();
                                                                }
                                                            }
                                                        },
                                                        {
                                                            button: {
                                                                class: 'btn danger',
                                                                text: 'üî• Clear All',
                                                                onclick: () => {
                                                                    measurePerformance('Clear All', () => {
                                                                        juris.setState('todos', []);
                                                                    });
                                                                    updateStats();
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            
                                            // SmartList component
                                            {
                                                SmartList: {
                                                    items: () => juris.getState('todos', []),
                                                    renderItem: (todo, index) => {
                                                        // Start timer and initialize reactive states for this item
                                                        startItemTimer(todo.id);
                                                        
                                                        return {
                                                            div: {
                                                                class: `todo-item ${todo.completed ? 'completed' : ''} ${todo.priority === 'high' ? 'high-priority' : ''}`,
                                                                children: [
                                                                    {
                                                                        input: {
                                                                            type: 'checkbox',
                                                                            class: 'todo-checkbox',
                                                                            checked: todo.completed,
                                                                            onchange: (e) => {
                                                                                const todos = juris.getState('todos', []);
                                                                                const updated = todos.map(t => 
                                                                                    t.id === todo.id ? {...t, completed: e.target.checked} : t
                                                                                );
                                                                                juris.setState('todos', updated);
                                                                                updateStats();
                                                                            }
                                                                        }
                                                                    },
                                                                    {
                                                                        div: {
                                                                            class: 'todo-content',
                                                                            children: [
                                                                                { div: { class: 'todo-title', text: todo.title } },
                                                                                {
                                                                                    div: {
                                                                                        class: 'todo-meta',
                                                                                        children: [
                                                                                            { span: { class: `priority-badge priority-${todo.priority}`, text: todo.priority } },
                                                                                            { span: { class: 'category-badge', text: todo.category } },
                                                                                            { span: { text: `Created: ${todo.created}` } }
                                                                                        ]
                                                                                    }
                                                                                },
                                                                                // DEEP REACTIVE SECTION
                                                                                {
                                                                                    div: {
                                                                                        class: 'reactive-section',
                                                                                        children: [
                                                                                            {
                                                                                                div: {
                                                                                                    class: 'reactive-row',
                                                                                                    children: [
                                                                                                        {
                                                                                                            span: {
                                                                                                                class: 'reactive-counter',
                                                                                                                text: () => `Clicks: ${juris.getState(`counters.${todo.id}`, 0)}`,
                                                                                                                onclick: () => incrementCounter(todo.id)
                                                                                                            }
                                                                                                        },
                                                                                                        {
                                                                                                            span: {
                                                                                                                class: 'reactive-timer',
                                                                                                                text: () => {
                                                                                                                    const seconds = juris.getState(`timers.${todo.id}`, 0);
                                                                                                                    const mins = Math.floor(seconds / 60);
                                                                                                                    const secs = seconds % 60;
                                                                                                                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                                                                                                                }
                                                                                                            }
                                                                                                        },
                                                                                                        {
                                                                                                            div: {
                                                                                                                class: () => {
                                                                                                                    const isSpinning = juris.getState(`animations.${todo.id}`, false);
                                                                                                                    return `animated-box ${isSpinning ? 'spinning' : 'normal'}`;
                                                                                                                },
                                                                                                                onclick: () => toggleAnimation(todo.id),
                                                                                                                title: 'Click to toggle animation'
                                                                                                            }
                                                                                                        }
                                                                                                    ]
                                                                                                }
                                                                                            },
                                                                                            {
                                                                                                div: {
                                                                                                    class: 'reactive-row',
                                                                                                    children: [
                                                                                                        {
                                                                                                            button: {
                                                                                                                class: 'btn btn-small',
                                                                                                                text: 'üîÑ Update Live Data',
                                                                                                                onclick: () => updateLiveData(todo.id)
                                                                                                            }
                                                                                                        },
                                                                                                        {
                                                                                                            span: {
                                                                                                                class: () => {
                                                                                                                    const liveData = juris.getState(`liveData.${todo.id}`, {});
                                                                                                                    return `live-status status-${liveData.status || 'idle'}`;
                                                                                                                },
                                                                                                                text: () => {
                                                                                                                    const liveData = juris.getState(`liveData.${todo.id}`, {});
                                                                                                                    return liveData.status || 'idle';
                                                                                                                }
                                                                                                            }
                                                                                                        },
                                                                                                        {
                                                                                                            div: {
                                                                                                                class: 'temperature-gauge',
                                                                                                                children: [
                                                                                                                    {
                                                                                                                        div: {
                                                                                                                            class: 'temperature-fill',
                                                                                                                            style: () => {
                                                                                                                                const liveData = juris.getState(`liveData.${todo.id}`, {});
                                                                                                                                const temp = liveData.temperature || 0;
                                                                                                                                const width = temp + '%';
                                                                                                                                const color = temp > 70 ? '#ef4444' : temp > 40 ? '#f59e0b' : '#10b981';
                                                                                                                                return { width, backgroundColor: color };
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                ]
                                                                                                            }
                                                                                                        },
                                                                                                        {
                                                                                                            span: {
                                                                                                                text: () => {
                                                                                                                    const liveData = juris.getState(`liveData.${todo.id}`, {});
                                                                                                                    return `${liveData.temperature || 0}¬∞C`;
                                                                                                                },
                                                                                                                style: {
                                                                                                                    fontSize: '11px',
                                                                                                                    color: '#666'
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    ]
                                                                                                }
                                                                                            },
                                                                                            {
                                                                                                div: {
                                                                                                    style: {
                                                                                                        fontSize: '10px',
                                                                                                        color: '#999',
                                                                                                        marginTop: '4px'
                                                                                                    },
                                                                                                    text: () => {
                                                                                                        const liveData = juris.getState(`liveData.${todo.id}`, {});
                                                                                                        return liveData.lastPing ? `Last ping: ${liveData.lastPing}` : 'No data yet';
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                }
                                                                            ]
                                                                        }
                                                                    },
                                                                    {
                                                                        div: {
                                                                            class: 'todo-actions',
                                                                            children: [
                                                                                {
                                                                                    button: {
                                                                                        class: 'btn btn-small danger',
                                                                                        text: '‚ùå',
                                                                                        onclick: () => {
                                                                                            const todos = juris.getState('todos', []);
                                                                                            const updated = todos.filter(t => t.id !== todo.id);
                                                                                            juris.setState('todos', updated);
                                                                                            updateStats();
                                                                                        }
                                                                                    }
                                                                                }
                                                                            ]
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        };
                                                    },
                                                    keyFn: (item) => item.id,
                                                    placeholder: {
                                                        div: {
                                                            class: 'empty-state',
                                                            text: 'No todos yet. Add some tasks to get started!'
                                                        }
                                                    }
                                                }
                                            },
                                            
                                            // Stats
                                            {
                                                div: {
                                                    class: 'stats',
                                                    children: [
                                                        {
                                                            div: {
                                                                class: 'stat-card',
                                                                children: [
                                                                    { span: { class: 'stat-number', text: () => juris.getState('stats.total', 0) } },
                                                                    { div: { class: 'stat-label', text: 'Total Todos' } }
                                                                ]
                                                            }
                                                        },
                                                        {
                                                            div: {
                                                                class: 'stat-card',
                                                                children: [
                                                                    { span: { class: 'stat-number', text: () => juris.getState('stats.completed', 0) } },
                                                                    { div: { class: 'stat-label', text: 'Completed' } }
                                                                ]
                                                            }
                                                        },
                                                        {
                                                            div: {
                                                                class: 'stat-card',
                                                                children: [
                                                                    { span: { class: 'stat-number', text: () => juris.getState('stats.highPriority', 0) } },
                                                                    { div: { class: 'stat-label', text: 'High Priority' } }
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                },
                                
                                // Performance Test Demo
                                {
                                    div: {
                                        class: 'demo-section',
                                        children: [
                                            { h2: { text: 'Performance Test' } },
                                            
                                            // Performance controls
                                            {
                                                div: {
                                                    class: 'controls',
                                                    children: [
                                                        {
                                                            div: {
                                                                class: 'input-group',
                                                                children: [
                                                                    { input: { type: 'number', id: 'itemCount', value: '100', min: '10', max: '5000' } },
                                                                    {
                                                                        button: {
                                                                            class: 'btn',
                                                                            text: '‚ö° Generate Items',
                                                                            onclick: () => {
                                                                                const count = parseInt(document.getElementById('itemCount').value) || 100;
                                                                                measurePerformance(`Generate ${count} Items`, () => {
                                                                                    const items = Array.from({length: count}, (_, i) => ({
                                                                                        id: i + 1,
                                                                                        value: Math.floor(Math.random() * 1000),
                                                                                        hue: Math.floor(Math.random() * 360),
                                                                                        lastUpdate: new Date().toLocaleTimeString()
                                                                                    }));
                                                                                    juris.setState('performanceItems', items);
                                                                                });
                                                                                juris.setState('performance.itemCount', count);
                                                                            }
                                                                        }
                                                                    },
                                                                    {
                                                                        button: {
                                                                            class: 'btn',
                                                                            text: 'üîÑ Update All',
                                                                            onclick: () => {
                                                                                measurePerformance('Update All Items', () => {
                                                                                    const items = juris.getState('performanceItems', []);
                                                                                    const updated = items.map(item => ({
                                                                                        ...item,
                                                                                        value: Math.floor(Math.random() * 1000),
                                                                                        lastUpdate: new Date().toLocaleTimeString()
                                                                                    }));
                                                                                    juris.setState('performanceItems', updated);
                                                                                });
                                                                            }
                                                                        }
                                                                    },
                                                                    {
                                                                        button: {
                                                                            class: 'btn danger',
                                                                            text: 'üóëÔ∏è Remove Every 2nd',
                                                                            onclick: () => {
                                                                                measurePerformance('Remove Every 2nd Item', () => {
                                                                                    const items = juris.getState('performanceItems', []);
                                                                                    const filtered = items.filter((_, index) => index % 2 === 0);
                                                                                    juris.setState('performanceItems', filtered);
                                                                                });
                                                                                juris.setState('performance.itemCount', Math.floor(juris.getState('performance.itemCount', 0) / 2));
                                                                            }
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            
                                            // Performance list
                                            {
                                                SmartList: {
                                                    items: () => juris.getState('performanceItems', []),
                                                    renderItem: (item, index) => ({
                                                        div: {
                                                            class: 'perf-item',
                                                            children: [
                                                                { 
                                                                    div: { 
                                                                        class: 'perf-item-color', 
                                                                        style: { backgroundColor: `hsl(${item.hue}, 70%, 50%)` }
                                                                    }
                                                                },
                                                                {
                                                                    div: {
                                                                        class: 'perf-item-content',
                                                                        children: [
                                                                            { div: { class: 'perf-item-title', text: `Item ${item.id}` } },
                                                                            { div: { class: 'perf-item-meta', text: `Value: ${item.value} | Updated: ${item.lastUpdate}` } }
                                                                        ]
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    }),
                                                    keyFn: (item) => item.id,
                                                    placeholder: {
                                                        div: {
                                                            class: 'empty-state',
                                                            text: 'Click "Generate Items" to start performance testing'
                                                        }
                                                    }
                                                }
                                            },
                                            
                                            // Performance info
                                            {
                                                div: {
                                                    class: 'performance-info',
                                                    text: () => {
                                                        const lastOp = juris.getState('performance.lastOperation', '');
                                                        const duration = juris.getState('performance.duration', 0);
                                                        const itemCount = juris.getState('performance.itemCount', 0);
                                                        
                                                        if (lastOp) {
                                                            return `üéØ Last Operation: ${lastOp}\n‚è±Ô∏è  Duration: ${duration}ms\nüìä Items: ${itemCount}\nüöÄ Items/ms: ${itemCount > 0 ? (itemCount / Math.max(duration, 0.01)).toFixed(2) : 0}\n\n‚ú® Smart Diffing: Key-based reuse, minimal DOM ops\nüîß Compatible with Juris 0.91.0`;
                                                        }
                                                        return 'üèÅ Ready for performance testing...\nüí° Watch the element keys (top-right) to see smart diffing in action!';
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    }
                ]
            }
        };

        // Initialize stats and render
        updateStats();
        juris.render('#app');

        // Add some sample todos after a brief delay
        setTimeout(() => {
            const sampleTodos = [
                { 
                    id: generateId(), 
                    title: 'üéâ Welcome to Juris 0.91.0!', 
                    completed: false, 
                    priority: 'high', 
                    category: 'work', 
                    created: new Date().toLocaleTimeString() 
                },
                { 
                    id: generateId(), 
                    title: 'üîç Try the Smart Diffing features', 
                    completed: false, 
                    priority: 'medium', 
                    category: 'personal', 
                    created: new Date().toLocaleTimeString() 
                },
                { 
                    id: generateId(), 
                    title: '‚ö° Test performance with many items', 
                    completed: true, 
                    priority: 'low', 
                    category: 'work', 
                    created: new Date().toLocaleTimeString() 
                }
            ];
            
            juris.setState('todos', sampleTodos);
            updateStats();
        }, 1000);

        console.log('üöÄ Juris 0.91.0 SmartList Demo Loaded');
        console.log('üìä Framework Version:', jurisVersion || '0.91.0');
        console.log('üéØ SmartList: Optimized for 0.91.0 architecture');
    </script>
</body>
</html>