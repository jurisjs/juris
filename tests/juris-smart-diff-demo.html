<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris Framework - Smart Diffing Demo</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .demo-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e0e7ff;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
        }

        .demo-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-section h2::before {
            content: "üöÄ";
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        input, select {
            padding: 10px 15px;
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .smart-list {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
            min-height: 200px;
        }

        .todo-item {
            background: white;
            border: 2px solid #e0e7ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .todo-item:hover {
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .todo-item.completed {
            opacity: 0.7;
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }

        .todo-item.high-priority {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
        }

        .todo-content {
            flex: 1;
        }

        .todo-title {
            font-weight: 600;
            color: #333;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .todo-meta {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #666;
        }

        .priority-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high { background: #fee2e2; color: #dc2626; }
        .priority-medium { background: #fef3c7; color: #d97706; }
        .priority-low { background: #e0f2fe; color: #0284c7; }

        .category-badge {
            background: #f3e8ff;
            color: #7c3aed;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .todo-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
            border: 2px solid #e0e7ff;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state::before {
            content: "üìù";
            font-size: 3rem;
            display: block;
            margin-bottom: 10px;
        }

        .performance-info {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 13px;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }

        .juris-async-loading {
            opacity: 0.6;
            background: #f0f0f0;
            border: 1px dashed #ccc;
            padding: 8px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .todo-item {
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <!-- Load the actual Juris framework -->
    <script src="https://unpkg.com/juris@0.9.0/juris.js"></script>
    <script src="../juris-ui/iterators/For.js"></script>
    
    <script>
        // Initialize Juris with configuration
        const app = new Juris({
            states: {
                todos: [],
                performanceItems: [],
                stats: {
                    total: 0,
                    completed: 0,
                    highPriority: 0
                },
                performance: {
                    lastOperation: '',
                    duration: 0,
                    itemCount: 0
                }
            },
            layout: null // Will be set below
        });

        // Register the SmartList and For components
        app.registerComponent('SmartList', SmartList);
        app.registerComponent('For', For);

        // Helper functions
        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function updateStats() {
            const todos = app.getState('todos', []);
            const total = todos.length;
            const completed = todos.filter(t => t.completed).length;
            const highPriority = todos.filter(t => t.priority === 'high').length;
            
            app.setState('stats.total', total);
            app.setState('stats.completed', completed);
            app.setState('stats.highPriority', highPriority);
        }

        function measurePerformance(operation, fn) {
            const start = performance.now();
            const result = fn();
            const duration = performance.now() - start;
            
            app.setState('performance.lastOperation', operation);
            app.setState('performance.duration', Math.round(duration * 100) / 100);
            
            return result;
        }

        // Todo item component
        function TodoItem(props, context) {
            const { todo } = props;
            const { getState, setState } = context;
            
            return {
                div: {
                    class: `todo-item ${todo.completed ? 'completed' : ''} ${todo.priority === 'high' ? 'high-priority' : ''}`,
                    children: [
                        {
                            input: {
                                type: 'checkbox',
                                checked: todo.completed,
                                onchange: (e) => {
                                    const todos = getState('todos', []);
                                    const updated = todos.map(t => 
                                        t.id === todo.id ? {...t, completed: e.target.checked} : t
                                    );
                                    setState('todos', updated);
                                    updateStats();
                                }
                            }
                        },
                        {
                            div: {
                                class: 'todo-content',
                                children: [
                                    {div: {class: 'todo-title', text: todo.title}},
                                    {
                                        div: {
                                            class: 'todo-meta',
                                            children: [
                                                {span: {class: `priority-badge priority-${todo.priority}`, text: todo.priority}},
                                                {span: {class: 'category-badge', text: todo.category}},
                                                {span: {text: `Created: ${todo.created}`}}
                                            ]
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            div: {
                                class: 'todo-actions',
                                children: [
                                    {
                                        button: {
                                            class: 'btn btn-small danger',
                                            text: 'Delete',
                                            onclick: () => {
                                                const todos = getState('todos', []);
                                                const updated = todos.filter(t => t.id !== todo.id);
                                                setState('todos', updated);
                                                updateStats();
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            };
        }

        // Performance item component
        function PerformanceItem(props, context) {
            const { item } = props;
            
            return {
                div: {
                    class: 'todo-item',
                    style: {
                        borderLeft: `4px solid hsl(${item.hue}, 70%, 50%)`
                    },
                    children: [
                        {div: {class: 'todo-title', text: `Item ${item.id}`}},
                        {div: {text: `Value: ${item.value} | Last Updated: ${item.lastUpdate}`}}
                    ]
                }
            };
        }

        // Register components
        app.registerComponent('TodoItem', TodoItem);
        app.registerComponent('PerformanceItem', PerformanceItem);

        // Set up the main layout
        app.layout = {
            div: {
                class: 'container',
                children: [
                    // Header
                    {
                        div: {
                            class: 'header',
                            children: [
                                {h1: {text: 'Juris Framework'}},
                                {p: {text: 'Smart Diffing & Reactive Components Demo'}}
                            ]
                        }
                    },
                    
                    // Main content
                    {
                        div: {
                            class: 'demo-grid',
                            children: [
                                // Todo List Demo
                                {
                                    div: {
                                        class: 'demo-section',
                                        children: [
                                            {h2: {text: 'Smart Todo List'}},
                                            
                                            // Add todo controls
                                            {
                                                div: {
                                                    class: 'controls',
                                                    children: [
                                                        {
                                                            div: {
                                                                class: 'input-group',
                                                                children: [
                                                                    {input: {type: 'text', id: 'todoTitle', placeholder: 'Enter todo title'}},
                                                                    {
                                                                        select: {
                                                                            id: 'todoPriority',
                                                                            children: [
                                                                                {option: {value: 'low', text: 'Low Priority'}},
                                                                                {option: {value: 'medium', text: 'Medium Priority'}},
                                                                                {option: {value: 'high', text: 'High Priority'}}
                                                                            ]
                                                                        }
                                                                    },
                                                                    {
                                                                        select: {
                                                                            id: 'todoCategory',
                                                                            children: [
                                                                                {option: {value: 'work', text: 'Work'}},
                                                                                {option: {value: 'personal', text: 'Personal'}},
                                                                                {option: {value: 'shopping', text: 'Shopping'}},
                                                                                {option: {value: 'health', text: 'Health'}}
                                                                            ]
                                                                        }
                                                                    },
                                                                    {
                                                                        button: {
                                                                            class: 'btn',
                                                                            text: 'Add Todo',
                                                                            onclick: () => {
                                                                                const titleEl = document.getElementById('todoTitle');
                                                                                const priorityEl = document.getElementById('todoPriority');
                                                                                const categoryEl = document.getElementById('todoCategory');
                                                                                
                                                                                if (titleEl.value.trim()) {
                                                                                    const newTodo = {
                                                                                        id: generateId(),
                                                                                        title: titleEl.value.trim(),
                                                                                        completed: false,
                                                                                        priority: priorityEl.value,
                                                                                        category: categoryEl.value,
                                                                                        created: new Date().toLocaleTimeString()
                                                                                    };
                                                                                    
                                                                                    measurePerformance('Add Todo', () => {
                                                                                        const todos = app.getState('todos', []);
                                                                                        app.setState('todos', [...todos, newTodo]);
                                                                                    });
                                                                                    
                                                                                    titleEl.value = '';
                                                                                    updateStats();
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            
                                            // Action controls
                                            {
                                                div: {
                                                    class: 'controls',
                                                    children: [
                                                        {
                                                            button: {
                                                                class: 'btn',
                                                                text: 'Shuffle Order',
                                                                onclick: () => {
                                                                    measurePerformance('Shuffle Todos', () => {
                                                                        const todos = [...app.getState('todos', [])];
                                                                        for (let i = todos.length - 1; i > 0; i--) {
                                                                            const j = Math.floor(Math.random() * (i + 1));
                                                                            [todos[i], todos[j]] = [todos[j], todos[i]];
                                                                        }
                                                                        app.setState('todos', todos);
                                                                    });
                                                                }
                                                            }
                                                        },
                                                        {
                                                            button: {
                                                                class: 'btn',
                                                                text: 'Add 5 Random',
                                                                onclick: () => {
                                                                    measurePerformance('Add 5 Random Todos', () => {
                                                                        const todos = app.getState('todos', []);
                                                                        const priorities = ['low', 'medium', 'high'];
                                                                        const categories = ['work', 'personal', 'shopping', 'health'];
                                                                        const tasks = [
                                                                            'Review quarterly reports',
                                                                            'Call dentist for appointment',
                                                                            'Buy groceries for dinner',
                                                                            'Exercise for 30 minutes',
                                                                            'Read industry news',
                                                                            'Update project documentation',
                                                                            'Organize desk workspace',
                                                                            'Plan weekend activities',
                                                                            'Submit expense reports',
                                                                            'Schedule team meeting'
                                                                        ];
                                                                        
                                                                        const newTodos = Array.from({length: 5}, () => ({
                                                                            id: generateId(),
                                                                            title: tasks[Math.floor(Math.random() * tasks.length)],
                                                                            completed: Math.random() < 0.3,
                                                                            priority: priorities[Math.floor(Math.random() * priorities.length)],
                                                                            category: categories[Math.floor(Math.random() * categories.length)],
                                                                            created: new Date().toLocaleTimeString()
                                                                        }));
                                                                        
                                                                        app.setState('todos', [...todos, ...newTodos]);
                                                                    });
                                                                    updateStats();
                                                                }
                                                            }
                                                        },
                                                        {
                                                            button: {
                                                                class: 'btn danger',
                                                                text: 'Clear Completed',
                                                                onclick: () => {
                                                                    measurePerformance('Clear Completed', () => {
                                                                        const todos = app.getState('todos', []);
                                                                        const remaining = todos.filter(t => !t.completed);
                                                                        app.setState('todos', remaining);
                                                                    });
                                                                    updateStats();
                                                                }
                                                            }
                                                        },
                                                        {
                                                            button: {
                                                                class: 'btn danger',
                                                                text: 'Clear All',
                                                                onclick: () => {
                                                                    measurePerformance('Clear All', () => {
                                                                        app.setState('todos', []);
                                                                    });
                                                                    updateStats();
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            
                                            // SmartList component
                                            {
                                                SmartList: {
                                                    class: 'smart-list',
                                                    items: () => app.getState('todos', []),
                                                    renderItem: (todo, index) => ({
                                                        TodoItem: { todo }
                                                    }),
                                                    keyFn: (item) => item.id,
                                                    placeholder: {
                                                        div: {
                                                            class: 'empty-state',
                                                            children: [
                                                                'No todos yet. Add some tasks to get started!'
                                                            ]
                                                        }
                                                    }
                                                }
                                            },
                                            
                                            // Stats
                                            {
                                                div: {
                                                    class: 'stats',
                                                    children: [
                                                        {
                                                            div: {
                                                                class: 'stat-card',
                                                                children: [
                                                                    {span: {class: 'stat-number', text: () => app.getState('stats.total', 0)}},
                                                                    {div: {class: 'stat-label', text: 'Total Todos'}}
                                                                ]
                                                            }
                                                        },
                                                        {
                                                            div: {
                                                                class: 'stat-card',
                                                                children: [
                                                                    {span: {class: 'stat-number', text: () => app.getState('stats.completed', 0)}},
                                                                    {div: {class: 'stat-label', text: 'Completed'}}
                                                                ]
                                                            }
                                                        },
                                                        {
                                                            div: {
                                                                class: 'stat-card',
                                                                children: [
                                                                    {span: {class: 'stat-number', text: () => app.getState('stats.highPriority', 0)}},
                                                                    {div: {class: 'stat-label', text: 'High Priority'}}
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                },
                                
                                // Performance Test Demo
                                {
                                    div: {
                                        class: 'demo-section',
                                        children: [
                                            {h2: {text: 'Performance Test'}},
                                            
                                            // Performance controls
                                            {
                                                div: {
                                                    class: 'controls',
                                                    children: [
                                                        {
                                                            div: {
                                                                class: 'input-group',
                                                                children: [
                                                                    {input: {type: 'number', id: 'itemCount', value: '100', min: '10', max: '10000'}},
                                                                    {
                                                                        button: {
                                                                            class: 'btn',
                                                                            text: 'Generate Items',
                                                                            onclick: () => {
                                                                                const count = parseInt(document.getElementById('itemCount').value) || 100;
                                                                                measurePerformance(`Generate ${count} Items`, () => {
                                                                                    const items = Array.from({length: count}, (_, i) => ({
                                                                                        id: i + 1,
                                                                                        value: Math.floor(Math.random() * 1000),
                                                                                        hue: Math.floor(Math.random() * 360),
                                                                                        lastUpdate: new Date().toLocaleTimeString()
                                                                                    }));
                                                                                    app.setState('performanceItems', items);
                                                                                });
                                                                                app.setState('performance.itemCount', count);
                                                                            }
                                                                        }
                                                                    },
                                                                    {
                                                                        button: {
                                                                            class: 'btn',
                                                                            text: 'Update All',
                                                                            onclick: () => {
                                                                                measurePerformance('Update All Items', () => {
                                                                                    const items = app.getState('performanceItems', []);
                                                                                    const updated = items.map(item => ({
                                                                                        ...item,
                                                                                        value: Math.floor(Math.random() * 1000),
                                                                                        lastUpdate: new Date().toLocaleTimeString()
                                                                                    }));
                                                                                    app.setState('performanceItems', updated);
                                                                                });
                                                                            }
                                                                        }
                                                                    },
                                                                    {
                                                                        button: {
                                                                            class: 'btn danger',
                                                                            text: 'Remove Every 2nd',
                                                                            onclick: () => {
                                                                                measurePerformance('Remove Every 2nd Item', () => {
                                                                                    const items = app.getState('performanceItems', []);
                                                                                    const filtered = items.filter((_, index) => index % 2 === 0);
                                                                                    app.setState('performanceItems', filtered);
                                                                                });
                                                                                app.setState('performance.itemCount', Math.floor(app.getState('performance.itemCount', 0) / 2));
                                                                            }
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                }
                                            },
                                            
                                            // Performance list
                                            {
                                                SmartList: {
                                                    class: 'smart-list',
                                                    items: () => app.getState('performanceItems', []),
                                                    renderItem: (item, index) => ({
                                                        PerformanceItem: { item }
                                                    }),
                                                    keyFn: (item) => item.id,
                                                    placeholder: {
                                                        div: {
                                                            class: 'empty-state',
                                                            children: [
                                                                'Click "Generate Items" to start performance testing'
                                                            ]
                                                        }
                                                    }
                                                }
                                            },
                                            
                                            // Performance info
                                            {
                                                div: {
                                                    class: 'performance-info',
                                                    text: () => {
                                                        const lastOp = app.getState('performance.lastOperation', '');
                                                        const duration = app.getState('performance.duration', 0);
                                                        const itemCount = app.getState('performance.itemCount', 0);
                                                        
                                                        if (lastOp) {
                                                            return `Last Operation: ${lastOp}\nDuration: ${duration}ms\nItems: ${itemCount}\nItems/ms: ${itemCount > 0 ? (itemCount / Math.max(duration, 0.01)).toFixed(2) : 0}`;
                                                        }
                                                        return 'Ready for performance testing...';
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    }
                ]
            }
        };

        // Initialize stats
        updateStats();
        
        // Render the application
        app.render('#app');
        
        // Add some sample todos
        setTimeout(() => {
            const sampleTodos = [
                { id: generateId(), title: 'Welcome to Juris Framework!', completed: false, priority: 'high', category: 'work', created: new Date().toLocaleTimeString() },
                { id: generateId(), title: 'Try the Smart Diffing features', completed: false, priority: 'medium', category: 'personal', created: new Date().toLocaleTimeString() },
                { id: generateId(), title: 'Test performance with many items', completed: true, priority: 'low', category: 'work', created: new Date().toLocaleTimeString() }
            ];
            
            app.setState('todos', sampleTodos);
            updateStats();
        }, 1000);
        
        // Log framework info
        console.log('üöÄ Juris Framework Demo Loaded');
        console.log(`üìä Version: ${jurisVersion}`);
        console.log(`üìù Lines of Code: ${jurisLinesOfCode}`);
        console.log(`üì¶ Minified Size: ${jurisMinifiedSize}`);
    </script>
</body>
</html>