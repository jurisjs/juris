<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmotionUI with Reactive Styling</title>
    <script src="../src/juris.0.9.0.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f9fafb;
            min-height: 100vh;
            padding: 2rem;
            font-family: system-ui, -apple-system, sans-serif;
        }

        .container {
            max-width: 96rem;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.25rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 1rem;
        }

        .header p {
            font-size: 1.25rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .header .status {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .grid.stats {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            grid-column: 1 / -1;
        }

        .section {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #374151;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .card-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .w-full {
            width: 100%;
        }

        .stat-item {
            padding: 0.75rem;
            background-color: #f9fafb;
            border-radius: 0.375rem;
        }

        .stat-label {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .stat-value {
            font-size: 1.125rem;
            font-weight: bold;
        }

        .font-mono {
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;
        }

        .text-green {
            color: #059669;
        }

        .text-red {
            color: #dc2626;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-8">
    <div class="container">
        <div class="header">
            <h1>üé≠ EmotionUI</h1>
            <p>Smart components with reactive styling</p>
            <div class="status">
                CSS Extraction: <span id="cssStatus" class="font-mono">Loading...</span>
            </div>
        </div>

        <div class="grid">
            <!-- Buttons Section -->
            <div class="section">
                <h2>üîò Emotion Buttons</h2>
                <div class="button-group" id="buttonShowcase"></div>
            </div>

            <!-- Reactive Buttons -->
            <div class="section">
                <h2>‚ö° Reactive Buttons</h2>
                <div class="button-group" id="reactiveButtons"></div>
            </div>

            <!-- Cards Section -->
            <div class="section">
                <h2>üóÉÔ∏è Dynamic Cards</h2>
                <div class="card-group" id="cardShowcase"></div>
            </div>

            <!-- Stats -->
            <div class="section stats">
                <h2>üìä System Stats</h2>
                <div class="grid">
                    <div class="stat-item">
                        <div class="stat-label">Current Emotion</div>
                        <div id="currentEmotion" class="stat-value">joy</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Interactions</div>
                        <div id="interactions" class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">CSS Rules</div>
                        <div id="cssRules" class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Restyle Mode</div>
                        <div id="restyleMode" class="stat-value">Off</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Animation</div>
                        <div id="animationMode" class="stat-value">Off</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Juris with CSS extraction
        const juris = new Juris({
            cssExtraction: true,
            states: {
                app: {
                    currentEmotion: 'joy',
                    interactions: 0,
                    isAnimating: false,
                    glowIntensity: 0.5
                },
                ui: {
                    emotion: {
                        restyle: false // Start with restyle disabled
                    }
                }
            }
        });

        // ==================== EMOTION BUTTON COMPONENT ====================
        const EButton = (props = {}) => {
            const {
                variant = 'joy',
                size = 'md',
                children = 'Button',
                onClick,
                disabled = false,
                style = {},
                className = '',
                ...otherProps
            } = props;

            // Emotion colors
            const emotionColors = {
                joy: { backgroundColor: '#fbbf24', color: '#1f2937' },
                sadness: { backgroundColor: '#3b82f6', color: '#ffffff' },
                anger: { backgroundColor: '#ef4444', color: '#ffffff' },
                fear: { backgroundColor: '#8b5cf6', color: '#ffffff' },
                calm: { backgroundColor: '#10b981', color: '#ffffff' },
                excitement: { backgroundColor: '#f97316', color: '#ffffff' },
                love: { backgroundColor: '#ec4899', color: '#ffffff' },
                confidence: { backgroundColor: '#22c55e', color: '#1f2937' },
                surprise: { backgroundColor: '#f59e0b', color: '#1f2937' },
                neutral: { backgroundColor: '#6b7280', color: '#ffffff' }
            };

            const sizes = {
                sm: { padding: '8px 16px', fontSize: '14px' },
                md: { padding: '12px 24px', fontSize: '16px' },
                lg: { padding: '16px 32px', fontSize: '18px' }
            };

            // Handle both static style objects and reactive style functions
            let finalStyle;

            if (typeof style === 'function') {
                // Reactive style function - return a function that combines everything
                finalStyle = (elm) => {
                    const reactiveStyles = style(elm);
                    
                    return {
                        display: 'inline-flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontWeight: '500',
                        borderRadius: '8px',
                        border: 'none',
                        cursor: disabled ? 'not-allowed' : 'pointer',
                        transition: 'all 0.2s ease-in-out',
                        opacity: disabled ? '0.5' : '1',
                        fontFamily: 'system-ui, -apple-system, sans-serif',
                        ...sizes[size],
                        ...emotionColors[variant],
                        ...reactiveStyles // Spread the reactive styles
                    };
                };
            } else {
                // Static style object - can be extracted
                finalStyle = {
                    display: 'inline-flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontWeight: '500',
                    borderRadius: '8px',
                    border: 'none',
                    cursor: disabled ? 'not-allowed' : 'pointer',
                    transition: 'all 0.2s ease-in-out',
                    opacity: disabled ? '0.5' : '1',
                    fontFamily: 'system-ui, -apple-system, sans-serif',
                    ...sizes[size],
                    ...emotionColors[variant],
                    ...style // Spread the static styles - THESE GET EXTRACTED
                };
            }

            return {
                button: {
                    style: finalStyle,
                    className: className,
                    disabled: disabled,
                    onClick: disabled ? undefined : onClick,
                    text: children,
                    'data-emotion': variant,
                    ...otherProps
                }
            };
        };

        // ==================== EMOTION CARD COMPONENT ====================
        const ECard = (props = {}) => {
            const {
                variant = 'joy',
                children = [],
                onClick,
                style = {},
                className = '',
                ...otherProps
            } = props;

            const emotionStyles = {
                joy: {
                    borderColor: '#fbbf24',
                    background: 'linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(251, 191, 36, 0.05))'
                },
                calm: {
                    borderColor: '#10b981',
                    background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05))'
                },
                love: {
                    borderColor: '#ec4899',
                    background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(236, 72, 153, 0.05))'
                }
            };

            const baseStyle = {
                borderRadius: '12px',
                padding: '24px',
                cursor: onClick ? 'pointer' : 'default',
                transition: 'all 0.3s ease-in-out',
                backgroundColor: 'white',
                border: '2px solid',
                ...emotionStyles[variant],
                ...style
            };

            return {
                div: {
                    style: baseStyle,
                    className: className,
                    onClick: onClick,
                    children: children,
                    'data-emotion': variant,
                    ...otherProps
                }
            };
        };

        // Register components
        juris.registerComponent('EButton', EButton);
        juris.registerComponent('ECard', ECard);

        // ==================== DEMO SETUP ====================
        function setupDemo() {
            setupBasicButtons();
            setupReactiveButtons();
            setupCards();
        }

        function setupBasicButtons() {
            const buttonShowcase = document.getElementById('buttonShowcase');
            const emotions = ['joy', 'sadness', 'anger', 'fear', 'calm', 'excitement', 'love', 'confidence', 'surprise', 'neutral'];
            
            // Add example with reactive style spread
            emotions.forEach((emotion, index) => {
                let customStyle = {};
                
                // Add some style variations
                if (index === 0) {
                    customStyle = {
                        border: '3px solid #000',
                        boxShadow: '0 8px 16px rgba(0,0,0,0.2)',
                        fontWeight: 'bold'
                    };
                } else if (index === 1) {
                    customStyle = {
                        borderRadius: '20px',
                        padding: '16px 32px',
                        textTransform: 'uppercase'
                    };
                } else if (index === 2) {
                    // Separate static and reactive styles for CSS extraction
                    
                    // First create a button with ONLY static styles (these get extracted)
                    if (index === 2) {
                        // Static version for initial render and extraction
                        customStyle = {
                            // These styles will be extracted by Juris
                            fontWeight: 'bold',
                            letterSpacing: '1px'
                        };
                    }
                    
                    // Then add reactive enhancement
                    const enhanceWithReactiveStyles = (button) => {
                        // This runs after the static button is created
                        setTimeout(() => {
                            const checkAndApplyStyles = () => {
                                const isRestyle = juris.getState('ui.emotion.restyle', false);
                                
                                if (isRestyle) {
                                    Object.assign(button.style, {
                                        border: '2px dashed #ff6b6b',
                                        background: 'linear-gradient(45deg, #ff6b6b, #ee5a24)',
                                        boxShadow: '0 10px 25px rgba(255, 107, 107, 0.4)',
                                        transform: 'rotate(-5deg) scale(1.1)',
                                        animation: 'pulse 1.5s infinite'
                                    });
                                } else {
                                    // Remove reactive styles
                                    button.style.border = '';
                                    button.style.background = '';
                                    button.style.boxShadow = '';
                                    button.style.transform = '';
                                    button.style.animation = '';
                                }
                            };
                            
                            // Subscribe to state changes
                            juris.subscribe('ui.emotion.restyle', checkAndApplyStyles);
                            
                            // Apply initial state
                            checkAndApplyStyles();
                        }, 0);
                    };
                    
                    // Store the enhancement function to apply after creation
                    customStyle.__enhance = enhanceWithReactiveStyles;
                } else if (index === 3) {
                    // Static styles for CSS extraction
                    customStyle = {
                        textDecoration: 'underline'
                    };
                } else if (index === 4) {
                    // Static styles for CSS extraction  
                    customStyle = {
                        textTransform: 'uppercase'
                    };
                }

                const button = juris.objectToHtml({
                    EButton: {
                        variant: emotion,
                        size: 'md',
                        children: emotion.charAt(0).toUpperCase() + emotion.slice(1),
                        className: 'w-full mb-2',
                        style: customStyle, // Apply conditional styling
                        onClick: () => {
                            juris.setState('app.currentEmotion', emotion);
                            const current = juris.getState('app.interactions', 0);
                            juris.setState('app.interactions', current + 1);
                        }
                    }
                });
                buttonShowcase.appendChild(button);
            });
        }

        function setupReactiveButtons() {
            const reactiveButtons = document.getElementById('reactiveButtons');
            
            // Toggle Animation Button
            const animationBtn = juris.objectToHtml({
                EButton: {
                    variant: 'love',
                    children: 'Toggle Animation',
                    className: 'w-full mb-3',
                    style: {
                        borderRadius: '25px',
                        textShadow: '0 1px 2px rgba(0,0,0,0.3)',
                        fontWeight: 'bold'
                    },
                    onClick: () => {
                        const current = juris.getState('app.isAnimating', false);
                        juris.setState('app.isAnimating', !current);
                        const interactions = juris.getState('app.interactions', 0);
                        juris.setState('app.interactions', interactions + 1);
                    }
                }
            });
            reactiveButtons.appendChild(animationBtn);

            // Reactive Restyle Button
            const reactiveBtn = juris.objectToHtml({
                EButton: {
                    variant: 'excitement',
                    children: 'Reactive Glow',
                    className: 'w-full mb-3',
                    style: (elm) => {
                        const shouldRestyle = juris.getState('ui.emotion.restyle', false);
                        
                        if (shouldRestyle) {
                            return {
                                border: '2px dashed #f97316',
                                background: 'linear-gradient(135deg, #f97316, #fb923c)',
                                position: 'relative',
                                overflow: 'hidden',
                                transform: 'scale(1.05) rotate(1deg)',
                                boxShadow: '0 8px 20px rgba(249, 115, 22, 0.4)',
                                animation: 'pulse 2s infinite'
                            };
                        }
                        
                        return {
                            borderRadius: '8px'
                        };
                    },
                    onClick: () => {
                        juris.setState('app.glowIntensity', Math.random());
                        const interactions = juris.getState('app.interactions', 0);
                        juris.setState('app.interactions', interactions + 1);
                    }
                }
            });
            reactiveButtons.appendChild(reactiveBtn);

            // Toggle Restyle Button
            const restyleToggle = juris.objectToHtml({
                EButton: {
                    variant: 'surprise',
                    children: 'Toggle Restyle',
                    className: 'w-full',
                    style: (elm) => {
                        const isActive = juris.getState('ui.emotion.restyle', false);
                        return {
                            border: isActive ? '3px solid #d97706' : '1px solid #f59e0b',
                            fontWeight: isActive ? 'bold' : 'normal',
                            textShadow: isActive ? '0 1px 2px rgba(0,0,0,0.5)' : 'none',
                            backgroundColor: isActive ? '#d97706' : '#f59e0b'
                        };
                    },
                    onClick: () => {
                        const current = juris.getState('ui.emotion.restyle', false);
                        juris.setState('ui.emotion.restyle', !current); // This actually toggles the state!
                        console.log('Restyle toggled to:', !current); // Debug log
                        const interactions = juris.getState('app.interactions', 0);
                        juris.setState('app.interactions', interactions + 1);
                    }
                }
            });
            reactiveButtons.appendChild(restyleToggle);
        }

        function setupCards() {
            const cardShowcase = document.getElementById('cardShowcase');
            const cardEmotions = ['joy', 'calm', 'love'];
            
            cardEmotions.forEach(emotion => {
                const card = juris.objectToHtml({
                    ECard: {
                        variant: emotion,
                        style: (elm) => {
                            const currentEmotion = juris.getState('app.currentEmotion', 'joy');
                            const interactions = juris.getState('app.interactions', 0);
                            
                            return {
                                opacity: currentEmotion === emotion ? 1 : 0.7,
                                transform: `scale(${currentEmotion === emotion ? 1.02 : 1}) rotate(${interactions * 0.1}deg)`,
                                filter: currentEmotion === emotion ? 'brightness(1.1)' : 'brightness(1)'
                            };
                        },
                        onClick: () => {
                            juris.setState('app.currentEmotion', emotion);
                            const interactions = juris.getState('app.interactions', 0);
                            juris.setState('app.interactions', interactions + 1);
                        },
                        children: [
                            {
                                h3: {
                                    text: `${emotion.charAt(0).toUpperCase() + emotion.slice(1)} Card`,
                                    style: { 
                                        margin: '0 0 12px 0', 
                                        fontSize: '18px', 
                                        fontWeight: '600',
                                        color: '#1f2937'
                                    }
                                }
                            },
                            {
                                p: {
                                    text: `This ${emotion} card uses Juris CSS extraction for optimal performance.`,
                                    style: { 
                                        margin: '0', 
                                        fontSize: '14px', 
                                        color: '#6b7280'
                                    }
                                }
                            }
                        ]
                    }
                });
                cardShowcase.appendChild(card);
            });
        }

        // ==================== STATS TRACKING ====================
        function updateStats() {
            const currentEmotion = juris.getState('app.currentEmotion', 'joy');
            const interactions = juris.getState('app.interactions', 0);
            const restyleMode = juris.getState('ui.emotion.restyle', false);
            const animationMode = juris.getState('app.isAnimating', false);
            
            document.getElementById('currentEmotion').textContent = currentEmotion;
            document.getElementById('interactions').textContent = interactions;
            document.getElementById('restyleMode').textContent = restyleMode ? 'On ‚ú®' : 'Off';
            document.getElementById('animationMode').textContent = animationMode ? 'On üé¨' : 'Off';
            
            // CSS extraction stats
            try {
                const stats = juris.domRenderer.getStats();
                document.getElementById('cssRules').textContent = stats.cssCache || 0;
            } catch (e) {
                document.getElementById('cssRules').textContent = 'N/A';
            }
            
            // CSS status
            const cssStatus = document.getElementById('cssStatus');
            cssStatus.textContent = juris.domRenderer.cssExtraction ? 'Enabled ‚úÖ' : 'Disabled ‚ùå';
            cssStatus.className = juris.domRenderer.cssExtraction ? 'font-mono text-green' : 'font-mono text-red';
        }

        // Subscribe to all state changes
        juris.subscribe('app.currentEmotion', updateStats);
        juris.subscribe('app.interactions', updateStats);
        juris.subscribe('app.isAnimating', updateStats);
        juris.subscribe('app.glowIntensity', updateStats);
        juris.subscribe('ui.emotion.restyle', updateStats);

        // Initialize everything
        setupDemo();
        updateStats();

        // Trigger restyle after initial render is complete
        setTimeout(() => {
            console.log('Triggering restyle after initial render...');
            juris.setState('ui.emotion.restyle', true);
        }, 100); // Small delay to ensure render is complete

        console.log('üé≠ EmotionUI with reactive styling loaded successfully!');
    </script>
</body>
</html>