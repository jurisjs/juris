<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Headless Registration</title>
  </head>
  <body>
    <div id="app"></div>

    <script src="../src/juris.js"></script>
		<script src="../src/juris-headless.js"></script>
    <script>
      // Initialize Juris app
      window.juris = new Juris({
        features: {
          headless: HeadlessManager,
        },
        layout: {
          div: {
            children: [{ Issue: {} }],
          },
        },
      });

      juris.registerHeadlessComponent(
        'DoSomethingElse',
        (props, { getState, setState }) => ({
          api: {
            now: () => {
              setState('doSomethingElse.now', 'called');
            },
          },
        }),
        { autoInit: true }
      );

      juris.registerHeadlessComponent(
        'DoSomething',
        (props, { getState, setState, DoSomethingElse }) => ({
          api: {
            now: () => {
              setState('doSomething.now', 'called');
              DoSomethingElse.now();
            },
          },
        }),
        { autoInit: true }
      );

      juris.registerComponent(
        'Issue',(props,{ setState, getState, services, utils, DoSomething, DoSomethingElse }) => {
            
					return {
						render: () => {
						DoSomething.now();
							return {
								pre: {
									text: () =>
										'state:\n' +
										JSON.stringify(juris.stateManager.state, null, 2) +
										'\nheadless\n' +
										JSON.stringify(utils.getHeadlessStatus(), null, 2),
								},
							};
						},
					}
				}
      );

      //juris.headlessManager.initializeQueued();
      juris.render('#app');
    </script>
  </body>
</html>