<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris Performance Benchmark - Standard Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .benchmark-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .benchmark-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .benchmark-button:hover {
            background: #0056b3;
        }
        
        .benchmark-button.running {
            background: #28a745;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .results {
            margin: 20px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 5px;
        }
        
        .result-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        
        .result-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
            padding: 3px 0;
        }
        
        .metric-label {
            color: #6c757d;
        }
        
        .metric-value {
            font-weight: bold;
            color: #007bff;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .winner {
            color: #28a745;
            font-weight: bold;
        }
        
        .test-description {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        #app {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            background: white;
        }
        
        /* Standard benchmark row styles */
        .row {
            padding: 8px 16px;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            align-items: center;
        }
        
        .row:nth-child(even) {
            background: #f8f9fa;
        }
        
        .col {
            padding: 0 8px;
            flex: 1;
        }
        
        .col:first-child {
            flex: 0 0 80px;
        }
        
        .col:last-child {
            flex: 0 0 120px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .selected {
            background-color: #ffeaa7 !important;
        }
    </style>
</head>
<body>
    <div class="benchmark-container">
        <h1>Juris Performance Benchmark</h1>
        <p>Standard js-framework-benchmark aligned tests with Juris reactive system</p>
        
        <div class="test-description">
            <h3>Test Scenarios (Based on js-framework-benchmark)</h3>
            <ul>
                <li><strong>Create 1000 rows:</strong> Initial render performance</li>
                <li><strong>Replace all rows:</strong> Full re-render performance</li>
                <li><strong>Update every 10th row:</strong> Selective update performance</li>
                <li><strong>Select row:</strong> Single element update</li>
                <li><strong>Swap rows:</strong> Position change performance</li>
                <li><strong>Remove row:</strong> Deletion performance</li>
                <li><strong>Clear all:</strong> Cleanup performance</li>
            </ul>
        </div>
        
        <div class="controls">
            <button class="benchmark-button" onclick="runTest('create')">Create 1,000 rows</button>
            <button class="benchmark-button" onclick="runTest('replace')">Replace all rows</button>
            <button class="benchmark-button" onclick="runTest('update')">Update every 10th row</button>
            <button class="benchmark-button" onclick="runTest('select')">Select row</button>
            <button class="benchmark-button" onclick="runTest('swap')">Swap rows</button>
            <button class="benchmark-button" onclick="runTest('remove')">Remove row</button>
            <button class="benchmark-button" onclick="runTest('clear')">Clear all</button>
            <button class="benchmark-button" onclick="runAllTests()" style="background: #28a745;">Run All Tests</button>
            <button class="benchmark-button" onclick="clearResults()" style="background: #6c757d;">Clear Results</button>
        </div>
        
        <div id="results" class="results" style="display: none;"></div>
        
        <div id="app"></div>
    </div>

    <script src="../src/juris.js"></script>
    <script>
        let jurisInstance = null;
        let testResults = [];
        let nextId = 1;
        let selectedRowId = null;
        
        // Adjectives and colors for row generation (standard benchmark data)
        const adjectives = ["pretty", "large", "big", "small", "tall", "short", "long", "handsome", "plain", "quaint", "clean", "elegant", "easy", "angry", "crazy", "helpful", "musty", "odd", "unsightly", "adorable", "important", "inexpensive", "cheap", "expensive", "fancy"];
        const colours = ["red", "yellow", "blue", "green", "pink", "brown", "purple", "brown", "white", "black", "orange"];
        const nouns = ["table", "chair", "house", "bbq", "desk", "car", "pony", "cookie", "sandwich", "burger", "pizza", "mouse", "keyboard"];
        
        function generateRow() {
            const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const colour = colours[Math.floor(Math.random() * colours.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            return {
                id: nextId++,
                label: `${adjective} ${colour} ${noun}`
            };
        }
        
        function generateRows(count = 1000) {
            return Array.from({ length: count }, () => generateRow());
        }
        
        function initializeJuris() {
            jurisInstance = new Juris({
                logLevel:'debug',
                states: {
                    rows: [],
                    selectedId: null
                },
                layout: {
                    div: {
                        children: () => {
                            const rows = jurisInstance.getState('rows', []);
                            const selectedId = jurisInstance.getState('selectedId', null);
                            
                            return rows.map(row => ({
                                div: {
                                    key: row.id,
                                    className: () => {
                                        const currentSelectedId = jurisInstance.getState('selectedId', null);
                                        return currentSelectedId === row.id ? 'row selected' : 'row';
                                    },
                                    children: [
                                        {
                                            div: {
                                                className: 'col',
                                                text: String(row.id)
                                            }
                                        },
                                        {
                                            div: {
                                                className: 'col',
                                                children: [
                                                    {
                                                        a: {
                                                            text: () => {
                                                                const currentRows = jurisInstance.getState('rows', []);
                                                                const currentRow = currentRows.find(r => r.id === row.id);
                                                                return currentRow ? currentRow.label : row.label;
                                                            },
                                                            onclick: () => selectRow(row.id)
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            div: {
                                                className: 'col',
                                                children: [
                                                    {
                                                        button: {
                                                            className: 'btn-danger',
                                                            text: '×',
                                                            onclick: () => removeRow(row.id)
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }));
                        }
                    }
                }
            });
            
            jurisInstance.render('#app');
        }
        
        function selectRow(id) {
            jurisInstance.setState('selectedId', id);
        }
        
        function removeRow(id) {
            const currentRows = jurisInstance.getState('rows', []);
            const newRows = currentRows.filter(row => row.id !== id);
            jurisInstance.setState('rows', newRows);
        }
        
        // Test implementations
        const tests = {
            create: {
                name: 'Create 1,000 rows',
                run: () => {
                    if (!jurisInstance) initializeJuris();
                    
                    // Pre-generate data to isolate framework performance
                    const rows = generateRows(1000);
                    
                    const startTime = performance.now();
                    jurisInstance.setState('rows', rows);
                    
                    // Use requestAnimationFrame to ensure DOM is updated
                    return new Promise(resolve => {
                        requestAnimationFrame(() => {
                            const endTime = performance.now();
                            resolve(endTime - startTime);
                        });
                    });
                }
            },
            
            replace: {
                name: 'Replace all rows',
                run: () => {
                    if (!jurisInstance) {
                        initializeJuris();
                        jurisInstance.setState('rows', generateRows(1000));
                    }
                    
                    // Pre-generate replacement data
                    const newRows = generateRows(1000);
                    
                    const startTime = performance.now();
                    jurisInstance.setState('rows', newRows);
                    
                    return new Promise(resolve => {
                        requestAnimationFrame(() => {
                            const endTime = performance.now();
                            resolve(endTime - startTime);
                        });
                    });
                }
            },
            
            update: {
                name: 'Update every 10th row',
                run: () => {
                    if (!jurisInstance || jurisInstance.getState('rows', []).length === 0) {
                        initializeJuris();
                        jurisInstance.setState('rows', generateRows(1000));
                    }
                    
                    const startTime = performance.now();
                    const currentRows = jurisInstance.getState('rows', []);
                    const updatedRows = currentRows.map((row, index) => {
                        if (index % 10 === 0) {
                            return { ...row, label: row.label + ' !!!' };
                        }
                        return row;
                    });
                    jurisInstance.setState('rows', updatedRows);
                    
                    return new Promise(resolve => {
                        requestAnimationFrame(() => {
                            const endTime = performance.now();
                            resolve(endTime - startTime);
                        });
                    });
                }
            },
            
            select: {
                name: 'Select row',
                run: () => {
                    if (!jurisInstance || jurisInstance.getState('rows', []).length === 0) {
                        initializeJuris();
                        jurisInstance.setState('rows', generateRows(1000));
                    }
                    
                    const startTime = performance.now();
                    const rows = jurisInstance.getState('rows', []);
                    const randomRow = rows[Math.floor(Math.random() * rows.length)];
                    jurisInstance.setState('selectedId', randomRow.id);
                    
                    return new Promise(resolve => {
                        requestAnimationFrame(() => {
                            const endTime = performance.now();
                            resolve(endTime - startTime);
                        });
                    });
                }
            },
            
            swap: {
                name: 'Swap rows',
                run: () => {
                    if (!jurisInstance || jurisInstance.getState('rows', []).length < 999) {
                        initializeJuris();
                        jurisInstance.setState('rows', generateRows(1000));
                    }
                    
                    const startTime = performance.now();
                    const currentRows = [...jurisInstance.getState('rows', [])];
                    
                    // Swap row at index 1 with row at index 998 (standard benchmark)
                    if (currentRows.length > 998) {
                        const temp = currentRows[1];
                        currentRows[1] = currentRows[998];
                        currentRows[998] = temp;
                        jurisInstance.setState('rows', currentRows);
                    }
                    
                    return new Promise(resolve => {
                        requestAnimationFrame(() => {
                            const endTime = performance.now();
                            resolve(endTime - startTime);
                        });
                    });
                }
            },
            
            remove: {
                name: 'Remove row',
                run: () => {
                    if (!jurisInstance || jurisInstance.getState('rows', []).length === 0) {
                        initializeJuris();
                        jurisInstance.setState('rows', generateRows(1000));
                    }
                    
                    const startTime = performance.now();
                    const currentRows = jurisInstance.getState('rows', []);
                    if (currentRows.length > 0) {
                        const randomIndex = Math.floor(Math.random() * currentRows.length);
                        const newRows = currentRows.filter((_, index) => index !== randomIndex);
                        jurisInstance.setState('rows', newRows);
                    }
                    
                    return new Promise(resolve => {
                        requestAnimationFrame(() => {
                            const endTime = performance.now();
                            resolve(endTime - startTime);
                        });
                    });
                }
            },
            
            clear: {
                name: 'Clear all',
                run: () => {
                    if (!jurisInstance) {
                        initializeJuris();
                        jurisInstance.setState('rows', generateRows(1000));
                    }
                    
                    const startTime = performance.now();
                    jurisInstance.setState('rows', []);
                    jurisInstance.setState('selectedId', null);
                    
                    return new Promise(resolve => {
                        requestAnimationFrame(() => {
                            const endTime = performance.now();
                            resolve(endTime - startTime);
                        });
                    });
                }
            }
        };
        
        async function runTest(testName) {
            const button = event.target;
            button.classList.add('running');
            button.textContent = `Running ${testName}...`;
            
            try {
                const test = tests[testName];
                if (!test) {
                    throw new Error(`Test ${testName} not found`);
                }
                
                // Run the test multiple times for more accurate results
                const iterations = 3;
                const times = [];
                
                for (let i = 0; i < iterations; i++) {
                    const time = await test.run();
                    times.push(time);
                    // Small delay between iterations
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                
                const result = {
                    name: test.name,
                    avgTime: avgTime.toFixed(2),
                    minTime: minTime.toFixed(2),
                    maxTime: maxTime.toFixed(2),
                    iterations,
                    timestamp: Date.now()
                };
                
                testResults.push(result);
                displayResults();
                
            } catch (error) {
                console.error(`Error running test ${testName}:`, error);
                alert(`Error running test: ${error.message}`);
            } finally {
                button.classList.remove('running');
                button.textContent = test.name;
            }
        }
        
        async function runAllTests() {
            const testNames = ['create', 'replace', 'update', 'select', 'swap', 'remove', 'clear'];
            
            for (const testName of testNames) {
                await runTest(testName);
                // Delay between tests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            displayComparisonTable();
        }
        
        function displayResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            
            let html = '<h3>Test Results</h3>';
            
            testResults.slice(-10).forEach(result => {
                html += `
                    <div class="result-card">
                        <div class="result-title">${result.name}</div>
                        <div class="metric">
                            <span class="metric-label">Average Time:</span>
                            <span class="metric-value">${result.avgTime}ms</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Min Time:</span>
                            <span class="metric-value">${result.minTime}ms</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Max Time:</span>
                            <span class="metric-value">${result.maxTime}ms</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Iterations:</span>
                            <span class="metric-value">${result.iterations}</span>
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        function displayComparisonTable() {
            const resultsDiv = document.getElementById('results');
            
            // Get latest results for each test type
            const latestResults = {};
            testResults.forEach(result => {
                latestResults[result.name] = result;
            });
            
            let tableHtml = `
                <h3>Performance Summary</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Test</th>
                            <th>Avg Time (ms)</th>
                            <th>Min Time (ms)</th>
                            <th>Max Time (ms)</th>
                            <th>Performance</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            Object.values(latestResults).forEach(result => {
                const avgTime = parseFloat(result.avgTime);
                let performance = 'Good';
                let performanceClass = '';
                
                if (avgTime < 5) {
                    performance = 'Excellent';
                    performanceClass = 'winner';
                } else if (avgTime < 10) {
                    performance = 'Very Good';
                    performanceClass = 'winner';
                } else if (avgTime < 20) {
                    performance = 'Good';
                }
                
                tableHtml += `
                    <tr>
                        <td>${result.name}</td>
                        <td class="${performanceClass}">${result.avgTime}</td>
                        <td>${result.minTime}</td>
                        <td>${result.maxTime}</td>
                        <td class="${performanceClass}">${performance}</td>
                    </tr>
                `;
            });
            
            tableHtml += '</tbody></table>';
            resultsDiv.innerHTML += tableHtml;
        }
        
        function clearResults() {
            testResults = [];
            document.getElementById('results').style.display = 'none';
            document.getElementById('app').innerHTML = '';
            if (jurisInstance) {
                jurisInstance.setState('rows', []);
                jurisInstance.setState('selectedId', null);
            }
        }
        
        // Initialize on page load
        window.addEventListener('load', () => {
            console.log('Juris Standard Benchmark initialized');
        });
    </script>
</body>
</html>