<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris Test Discovery App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 70vh;
        }
        
        .left-panel {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e9ecef;
        }
        
        .right-panel {
            padding: 30px;
            background: white;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        textarea, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        textarea {
            height: 200px;
            resize: vertical;
        }
        
        textarea:focus, input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .results-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .test-category {
            background: white;
            border-radius: 6px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .category-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 12px 20px;
            font-weight: 600;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-body {
            padding: 15px 20px;
            display: none;
        }
        
        .category-body.expanded {
            display: block;
        }
        
        .test-item {
            background: #f8f9fa;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            border-left: 4px solid #3498db;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 13px;
        }
        
        .test-item:last-child {
            margin-bottom: 0;
        }
        
        .test-selector {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .test-description {
            color: #555;
            margin-top: 4px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .vdom-tree {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .vdom-node {
            margin-left: 20px;
            position: relative;
        }
        
        .vdom-tag {
            color: #3498db;
            font-weight: bold;
        }
        
        .vdom-attr {
            color: #e67e22;
        }
        
        .vdom-value {
            color: #27ae60;
        }
        
        .vdom-text {
            color: #f39c12;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .code-export {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧪 Juris Test Discovery</h1>
            <p>Analyze Virtual DOM structures to generate comprehensive test cases</p>
        </div>
        
        <div class="main-content">
            <div class="left-panel">
                <h2 class="section-title">Setup & Configuration</h2>
                
                <div class="input-group">
                    <label for="layoutCode">Juris Layout Code:</label>
                    <textarea id="layoutCode" placeholder="Paste your Juris layout object here...">
{
  div: {
    class: 'app-container',
    style: { padding: '20px', backgroundColor: '#f0f0f0' },
    children: [
      {
        header: {
          class: 'main-header',
          children: [
            { h1: { text: 'Welcome to Test App', class: 'title' } },
            { 
              nav: { 
                class: 'navigation',
                children: [
                  { a: { href: '/home', text: 'Home', class: 'nav-link' } },
                  { a: { href: '/about', text: 'About', class: 'nav-link' } }
                ]
              }
            }
          ]
        }
      },
      {
        main: {
          class: 'content',
          children: [
            { 
              button: { 
                text: 'Click Me', 
                class: 'btn primary',
                onclick: () => alert('clicked'),
                style: { color: 'blue' }
              }
            },
            {
              form: {
                class: 'user-form',
                children: [
                  { input: { type: 'text', placeholder: 'Enter name', class: 'form-input' } },
                  { input: { type: 'email', placeholder: 'Enter email', class: 'form-input' } },
                  { button: { type: 'submit', text: 'Submit', class: 'btn secondary' } }
                ]
              }
            }
          ]
        }
      }
    ]
  }
}
                    </textarea>
                </div>
                
                <div class="input-group">
                    <label for="componentsCode">Components (Optional):</label>
                    <textarea id="componentsCode" placeholder="Define custom components...">
{
  "UserCard": (props) => ({
    div: {
      class: 'user-card',
      children: [
        { h3: { text: props.name } },
        { p: { text: props.email } }
      ]
    }
  }),
  "Counter": (props) => ({
    div: {
      class: 'counter',
      children: [
        { span: { text: () => getState('count', 0) } },
        { button: { text: '+', onclick: () => setState('count', getState('count', 0) + 1) } }
      ]
    }
  })
}
                    </textarea>
                </div>
                
                <div class="controls">
                    <button class="btn-primary" onclick="discoverTests()">🔍 Discover Tests</button>
                    <button class="btn-secondary" onclick="showVDOM()">🌳 Show VDOM</button>
                    <button class="btn-success" onclick="exportTests()">📤 Export Tests</button>
                    <button class="btn-warning" onclick="clearResults()">🗑️ Clear</button>
                </div>
            </div>
            
            <div class="right-panel">
                <h2 class="section-title">Test Discovery Results</h2>
                
                <div class="stats" id="stats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-number" id="totalElements">0</div>
                        <div class="stat-label">Elements</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalComponents">0</div>
                        <div class="stat-label">Components</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalInteractions">0</div>
                        <div class="stat-label">Interactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalTests">0</div>
                        <div class="stat-label">Test Cases</div>
                    </div>
                </div>
                
                <div class="results-container" id="results">
                    <p style="text-align: center; color: #7f8c8d; font-style: italic;">
                        Click "Discover Tests" to analyze your Juris layout and generate test cases.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="../src/juris.js"></script>
    <script>
        // Extend Juris class with getVDOM method if it doesn't exist
        if (typeof Juris !== 'undefined' && !Juris.prototype.getVDOM) {
            Juris.prototype.getVDOM = function() {
                console.info('VDOM generation started');
                const startTime = performance.now();
                
                try {
                    const vdom = this.processVDOMNode(this.layout, '');
                    
                    const duration = performance.now() - startTime;
                    console.info(`VDOM generation completed in ${duration.toFixed(2)}ms`);
                    
                    return vdom;
                } catch (error) {
                    console.error('VDOM generation failed:', error.message);
                    throw error;
                }
            };
            
            Juris.prototype.processVDOMNode = function(vnode, path, depth = 0) {
                if (typeof vnode === 'string' || typeof vnode === 'number') {
                    return {
                        type: 'text',
                        value: String(vnode),
                        path,
                        depth
                    };
                }
                
                if (typeof vnode === 'function') {
                    // Handle reactive functions - capture their current state
                    const dependencies = this.stateManager.startTracking();
                    const originalTracking = this.stateManager.currentTracking;
                    this.stateManager.currentTracking = dependencies;
                    
                    let result;
                    try {
                        result = vnode();
                    } finally {
                        this.stateManager.currentTracking = originalTracking;
                    }
                    
                    return {
                        type: 'reactive',
                        function: vnode.toString(),
                        dependencies: Array.from(dependencies),
                        currentValue: this.processVDOMNode(result, `${path}()`, depth),
                        path,
                        depth
                    };
                }
                
                if (!vnode || typeof vnode !== 'object') {
                    return null;
                }
                
                if (Array.isArray(vnode)) {
                    return {
                        type: 'array',
                        children: vnode.map((child, index) => 
                            this.processVDOMNode(child, `${path}[${index}]`, depth)
                        ).filter(Boolean),
                        path,
                        depth
                    };
                }
                
                // Handle object nodes (elements/components)
                const tagName = Object.keys(vnode)[0];
                const props = vnode[tagName] || {};
                
                const processed = {
                    type: this.isComponent(tagName) ? 'component' : 'element',
                    tagName,
                    path,
                    depth,
                    props: this.processProps(props, `${path}.${tagName}`),
                    children: [],
                    metadata: {
                        isCustomComponent: this.componentManager.components.has(tagName),
                        hasReactiveProps: this.hasReactiveProps(props),
                        hasEventHandlers: this.hasEventHandlers(props)
                    }
                };
                
                // Process children
                if (props.children) {
                    if (Array.isArray(props.children)) {
                        processed.children = props.children.map((child, index) => 
                            this.processVDOMNode(child, `${path}.${tagName}.children[${index}]`, depth + 1)
                        ).filter(Boolean);
                    } else {
                        const childResult = this.processVDOMNode(props.children, `${path}.${tagName}.children`, depth + 1);
                        if (childResult) {
                            processed.children = [childResult];
                        }
                    }
                }
                
                // Handle component expansion
                if (processed.type === 'component' && this.componentManager.components.has(tagName)) {
                    try {
                        const componentFn = this.componentManager.components.get(tagName);
                        const componentResult = componentFn(props, this.createContext());
                        
                        processed.componentVDOM = this.processVDOMNode(
                            componentResult, 
                            `${path}.${tagName}._component`, 
                            depth + 1
                        );
                    } catch (error) {
                        processed.componentError = error.message;
                    }
                }
                
                return processed;
            };
            
            Juris.prototype.processProps = function(props, basePath) {
                const processed = {};
                
                Object.entries(props).forEach(([key, value]) => {
                    if (key === 'children') return; // Handled separately
                    
                    if (typeof value === 'function') {
                        if (key.startsWith('on')) {
                            // Event handler
                            processed[key] = {
                                type: 'event_handler',
                                eventType: key.substring(2).toLowerCase(),
                                function: value.toString(),
                                path: `${basePath}.${key}`
                            };
                        } else {
                            // Reactive prop
                            const dependencies = this.stateManager.startTracking();
                            const originalTracking = this.stateManager.currentTracking;
                            this.stateManager.currentTracking = dependencies;
                            
                            let currentValue;
                            try {
                                currentValue = value();
                            } catch (error) {
                                currentValue = { error: error.message };
                            } finally {
                                this.stateManager.currentTracking = originalTracking;
                            }
                            
                            processed[key] = {
                                type: 'reactive_prop',
                                function: value.toString(),
                                dependencies: Array.from(dependencies),
                                currentValue,
                                path: `${basePath}.${key}`
                            };
                        }
                    } else if (value && typeof value === 'object') {
                        // Style objects, etc.
                        processed[key] = {
                            type: 'object_prop',
                            value: { ...value },
                            path: `${basePath}.${key}`
                        };
                    } else {
                        // Static prop
                        processed[key] = {
                            type: 'static_prop',
                            value,
                            path: `${basePath}.${key}`
                        };
                    }
                });
                
                return processed;
            };
            
            Juris.prototype.isComponent = function(tagName) {
                return /^[A-Z]/.test(tagName) || this.componentManager.components.has(tagName);
            };
            
            Juris.prototype.hasReactiveProps = function(props) {
                return Object.entries(props).some(([key, value]) => 
                    typeof value === 'function' && !key.startsWith('on')
                );
            };
            
            Juris.prototype.hasEventHandlers = function(props) {
                return Object.keys(props).some(key => key.startsWith('on'));
            };
        }

        class TestDiscoverer {
            constructor() {
                this.testCases = {
                    structure: [],
                    styling: [],
                    interactions: [],
                    content: [],
                    components: [],
                    accessibility: []
                };
                this.stats = {
                    totalElements: 0,
                    totalComponents: 0,
                    totalInteractions: 0,
                    totalTests: 0
                };
            }
            
            discover(vdom) {
                this.testCases = {
                    structure: [],
                    styling: [],
                    interactions: [],
                    content: [],
                    components: [],
                    accessibility: []
                };
                this.stats = {
                    totalElements: 0,
                    totalComponents: 0,
                    totalInteractions: 0,
                    totalTests: 0
                };
                
                this.analyzeVDOM(vdom);
                this.calculateStats();
                return this.testCases;
            }
            
            analyzeVDOM(vnode, depth = 0) {
                if (!vnode) return;
                
                if (Array.isArray(vnode)) {
                    vnode.forEach(child => this.analyzeVDOM(child, depth));
                    return;
                }
                
                if (vnode.type === 'text') {
                    this.analyzeTextNode(vnode, depth);
                    return;
                }
                
                if (vnode.type === 'element') {
                    this.stats.totalElements++;
                    this.analyzeElement(vnode, depth);
                    
                    if (vnode.children) {
                        vnode.children.forEach(child => this.analyzeVDOM(child, depth + 1));
                    }
                }
            }
            
            analyzeElement(vnode, depth) {
                const { tagName, props, path } = vnode;
                const selector = this.generateSelector(vnode);
                
                // Structure tests
                this.testCases.structure.push({
                    type: 'element_exists',
                    selector,
                    description: `Should render ${tagName} element`,
                    path,
                    depth
                });
                
                // Children count test
                if (vnode.children && vnode.children.length > 0) {
                    this.testCases.structure.push({
                        type: 'children_count',
                        selector,
                        description: `Should have ${vnode.children.length} children`,
                        expectedCount: vnode.children.length,
                        path
                    });
                }
                
                // Analyze props
                this.analyzeProps(vnode, selector);
                
                // Component detection
                if (this.isComponent(tagName)) {
                    this.stats.totalComponents++;
                    this.testCases.components.push({
                        type: 'component',
                        selector,
                        description: `Should render ${tagName} component`,
                        componentName: tagName,
                        path
                    });
                }
                
                // Accessibility tests
                this.analyzeAccessibility(vnode, selector);
            }
            
            analyzeProps(vnode, selector) {
                const { props, tagName } = vnode;
                
                Object.entries(props).forEach(([key, value]) => {
                    // Handle processed props structure from real Juris VDOM
                    const extractValue = (propValue) => {
                        if (typeof propValue === 'object' && propValue !== null) {
                            if (propValue.type === 'static_prop') return propValue.value;
                            if (propValue.type === 'object_prop') return propValue.value;
                            if (propValue.type === 'reactive_prop') return propValue.currentValue;
                            if (propValue.value !== undefined) return propValue.value;
                        }
                        return propValue;
                    };
                    
                    const extractedValue = extractValue(value);
                    
                    switch (key) {
                        case 'class':
                        case 'className':
                            if (extractedValue && typeof extractedValue === 'string') {
                                this.testCases.styling.push({
                                    type: 'css_class',
                                    selector,
                                    description: `Should have class "${extractedValue}"`,
                                    attribute: 'class',
                                    expectedValue: extractedValue,
                                    path: vnode.path
                                });
                            }
                            break;
                            
                        case 'style':
                            if (typeof extractedValue === 'object' && extractedValue !== null) {
                                Object.entries(extractedValue).forEach(([styleProp, styleValue]) => {
                                    this.testCases.styling.push({
                                        type: 'inline_style',
                                        selector,
                                        description: `Should have ${styleProp}: ${styleValue}`,
                                        styleProperty: styleProp,
                                        expectedValue: styleValue,
                                        path: vnode.path
                                    });
                                });
                            }
                            break;
                            
                        case 'text':
                            if (extractedValue) {
                                this.testCases.content.push({
                                    type: 'text_content',
                                    selector,
                                    description: `Should contain text "${extractedValue}"`,
                                    expectedText: extractedValue,
                                    path: vnode.path
                                });
                            }
                            break;
                            
                        case 'id':
                            if (extractedValue) {
                                this.testCases.structure.push({
                                    type: 'attribute',
                                    selector,
                                    description: `Should have id "${extractedValue}"`,
                                    attribute: 'id',
                                    expectedValue: extractedValue,
                                    path: vnode.path
                                });
                            }
                            break;
                            
                        default:
                            // Handle event handlers from processed VDOM
                            if (typeof value === 'object' && value?.type === 'event_handler') {
                                this.stats.totalInteractions++;
                                this.testCases.interactions.push({
                                    type: 'event_handler',
                                    selector,
                                    description: `Should handle ${value.eventType} event`,
                                    eventType: value.eventType,
                                    path: vnode.path
                                });
                            } else if (key.startsWith('on') && typeof extractedValue === 'function') {
                                // Legacy event handler detection
                                this.stats.totalInteractions++;
                                this.testCases.interactions.push({
                                    type: 'event_handler',
                                    selector,
                                    description: `Should handle ${key} event`,
                                    eventType: key.substring(2),
                                    path: vnode.path
                                });
                            } else if (extractedValue !== undefined && typeof extractedValue !== 'function') {
                                this.testCases.structure.push({
                                    type: 'attribute',
                                    selector,
                                    description: `Should have ${key}="${extractedValue}"`,
                                    attribute: key,
                                    expectedValue: extractedValue,
                                    path: vnode.path
                                });
                            }
                            break;
                    }
                });
            }
            
            analyzeTextNode(vnode, depth) {
                if (vnode.value && vnode.value.toString().trim()) {
                    this.testCases.content.push({
                        type: 'text_node',
                        description: `Should display text "${vnode.value}"`,
                        expectedText: vnode.value,
                        path: vnode.path,
                        depth
                    });
                }
            }
            
            analyzeAccessibility(vnode, selector) {
                const { tagName, props } = vnode;
                
                // Form accessibility
                if (['input', 'textarea', 'select'].includes(tagName.toLowerCase())) {
                    if (!props.id && !props['aria-label'] && !props['aria-labelledby']) {
                        this.testCases.accessibility.push({
                            type: 'missing_label',
                            selector,
                            description: `Input should have accessible label`,
                            severity: 'warning',
                            path: vnode.path
                        });
                    }
                }
                
                // Button accessibility
                if (tagName.toLowerCase() === 'button' && !props.text && !props['aria-label']) {
                    this.testCases.accessibility.push({
                        type: 'missing_button_text',
                        selector,
                        description: `Button should have accessible text`,
                        severity: 'warning',
                        path: vnode.path
                    });
                }
                
                // Image accessibility
                if (tagName.toLowerCase() === 'img' && !props.alt) {
                    this.testCases.accessibility.push({
                        type: 'missing_alt_text',
                        selector,
                        description: `Image should have alt text`,
                        severity: 'error',
                        path: vnode.path
                    });
                }
            }
            
            generateSelector(vnode) {
                const { tagName, props } = vnode;
                
                // Handle processed props structure from real Juris VDOM
                const getId = (props) => {
                    if (props.id) {
                        if (typeof props.id === 'object' && props.id.value) {
                            return props.id.value;
                        }
                        return props.id;
                    }
                    return null;
                };
                
                const getClass = (props) => {
                    const classValue = props.class || props.className;
                    if (!classValue) return null;
                    
                    if (typeof classValue === 'object' && classValue.value) {
                        return classValue.value;
                    }
                    if (typeof classValue === 'string') {
                        return classValue;
                    }
                    return null;
                };
                
                const id = getId(props);
                if (id) {
                    return `#${id}`;
                }
                
                const classValue = getClass(props);
                if (classValue && typeof classValue === 'string') {
                    const classes = classValue.split(' ').filter(Boolean);
                    if (classes.length > 0) {
                        return `${tagName}.${classes.join('.')}`;
                    }
                }
                
                return tagName;
            }
            
            isComponent(tagName) {
                return /^[A-Z]/.test(tagName);
            }
            
            calculateStats() {
                this.stats.totalTests = Object.values(this.testCases).reduce(
                    (total, category) => total + category.length, 0
                );
            }
        }

        let currentJuris = null;
        let currentTestCases = null;

        function parseCode(code) {
            try {
                // Handle both object literals and JSON
                if (code.trim().startsWith('{')) {
                    return eval(`(${code})`);
                }
                return JSON.parse(code);
            } catch (e) {
                throw new Error(`Code parsing failed: ${e.message}`);
            }
        }

        function discoverTests() {
            try {
                const layoutCode = document.getElementById('layoutCode').value.trim();
                const componentsCode = document.getElementById('componentsCode').value.trim();
                
                if (!layoutCode) {
                    showError('Please provide a layout to analyze');
                    return;
                }
                
                const layout = parseCode(layoutCode);
                const components = componentsCode ? parseCode(componentsCode) : {};
                
                // Create real Juris instance
                currentJuris = new Juris({
                    layout,
                    components,
                    states: {
                        count: 0,
                        user: { name: 'Test User', email: 'test@example.com' }
                    }
                });
                
                // Register components if provided
                if (components && typeof components === 'object') {
                    Object.entries(components).forEach(([name, componentFn]) => {
                        currentJuris.registerComponent(name, componentFn);
                    });
                }
                
                // Get VDOM using the real Juris getVDOM method
                const vdom = currentJuris.getVDOM();
                
                // Discover tests
                const discoverer = new TestDiscoverer();
                currentTestCases = discoverer.discover(vdom);
                
                // Update UI
                updateStats(discoverer.stats);
                displayTestCases(currentTestCases);
                
                showSuccess('Test discovery completed successfully!');
                
            } catch (error) {
                showError(`Discovery failed: ${error.message}`);
                console.error(error);
            }
        }

        function showVDOM() {
            if (!currentJuris) {
                showError('Please run test discovery first');
                return;
            }
            
            try {
                const vdom = currentJuris.getVDOM();
                const vdomDisplay = formatVDOM(vdom);
                
                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = `
                    <h3 style="margin-bottom: 15px;">Virtual DOM Structure</h3>
                    <div class="vdom-tree">${vdomDisplay}</div>
                    <button class="btn-secondary" onclick="discoverTests()" style="margin-top: 15px;">
                        ← Back to Test Cases
                    </button>
                `;
            } catch (error) {
                showError(`VDOM display failed: ${error.message}`);
            }
        }

        function formatVDOM(vnode, indent = 0) {
            const spaces = '  '.repeat(indent);
            
            if (!vnode) return '';
            
            if (Array.isArray(vnode)) {
                return vnode.map(child => formatVDOM(child, indent)).join('\n');
            }
            
            if (vnode.type === 'text') {
                return `${spaces}<span class="vdom-text">"${vnode.value}"</span>`;
            }
            
            if (vnode.type === 'element') {
                let result = `${spaces}<span class="vdom-tag">&lt;${vnode.tagName}</span>`;
                
                // Add props
                Object.entries(vnode.props).forEach(([key, value]) => {
                    if (typeof value === 'function') {
                        result += ` <span class="vdom-attr">${key}</span>=<span class="vdom-value">{function}</span>`;
                    } else if (typeof value === 'object') {
                        result += ` <span class="vdom-attr">${key}</span>=<span class="vdom-value">{object}</span>`;
                    } else {
                        result += ` <span class="vdom-attr">${key}</span>=<span class="vdom-value">"${value}"</span>`;
                    }
                });
                
                result += '<span class="vdom-tag">&gt;</span>';
                
                if (vnode.children && vnode.children.length > 0) {
                    result += '\n';
                    result += vnode.children.map(child => formatVDOM(child, indent + 1)).join('\n');
                    result += `\n${spaces}`;
                }
                
                result += `<span class="vdom-tag">&lt;/${vnode.tagName}&gt;</span>`;
                
                return result;
            }
            
            return '';
        }

        function updateStats(stats) {
            document.getElementById('stats').style.display = 'grid';
            document.getElementById('totalElements').textContent = stats.totalElements;
            document.getElementById('totalComponents').textContent = stats.totalComponents;
            document.getElementById('totalInteractions').textContent = stats.totalInteractions;
            document.getElementById('totalTests').textContent = stats.totalTests;
        }

        function displayTestCases(testCases) {
            const resultsContainer = document.getElementById('results');
            let html = '';
            
            Object.entries(testCases).forEach(([category, tests]) => {
                if (tests.length === 0) return;
                
                html += `
                    <div class="test-category">
                        <div class="category-header" onclick="toggleCategory('${category}')">
                            <span>${formatCategoryName(category)} (${tests.length})</span>
                            <span>▼</span>
                        </div>
                        <div class="category-body" id="${category}-body">
                            ${tests.map(test => formatTestCase(test)).join('')}
                        </div>
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = html;
        }

        function formatCategoryName(category) {
            const names = {
                structure: '🏗️ Structure Tests',
                styling: '🎨 Styling Tests',
                interactions: '🖱️ Interaction Tests',
                content: '📝 Content Tests',
                components: '🧩 Component Tests',
                accessibility: '♿ Accessibility Tests'
            };
            return names[category] || category;
        }

        function formatTestCase(test) {
            return `
                <div class="test-item">
                    <div class="test-selector">${test.selector || test.path || 'N/A'}</div>
                    <div class="test-description">${test.description}</div>
                    ${test.expectedValue ? `<div style="color: #27ae60; margin-top: 4px;">Expected: ${test.expectedValue}</div>` : ''}
                    ${test.severity ? `<div style="color: ${test.severity === 'error' ? '#e74c3c' : '#f39c12'}; margin-top: 4px;">Severity: ${test.severity}</div>` : ''}
                </div>
            `;
        }

        function toggleCategory(category) {
            const body = document.getElementById(`${category}-body`);
            body.classList.toggle('expanded');
        }

        function exportTests() {
            if (!currentTestCases) {
                showError('Please run test discovery first');
                return;
            }
            
            const exports = {
                jest: generateJestTests(),
                cypress: generateCypressTests(),
                playwright: generatePlaywrightTests()
            };
            
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = `
                <h3 style="margin-bottom: 15px;">Export Test Code</h3>
                <div class="controls">
                    <button class="btn-primary" onclick="showExport('jest')">Jest Tests</button>
                    <button class="btn-primary" onclick="showExport('cypress')">Cypress Tests</button>
                    <button class="btn-primary" onclick="showExport('playwright')">Playwright Tests</button>
                    <button class="btn-secondary" onclick="discoverTests()">← Back to Results</button>
                </div>
                <div id="exportContent"></div>
            `;
        }

        function showExport(type) {
            const exports = {
                jest: generateJestTests(),
                cypress: generateCypressTests(),
                playwright: generatePlaywrightTests()
            };
            
            document.getElementById('exportContent').innerHTML = `
                <h4 style="margin: 20px 0 10px 0;">${type.toUpperCase()} Test Code</h4>
                <div class="code-export">${exports[type]}</div>
            `;
        }

        function generateJestTests() {
            let code = `// Jest Test Suite Generated by Juris Test Discovery
import { render } from '@testing-library/react';
import { screen } from '@testing-library/dom';

describe('Juris Application Tests', () => {
`;

            Object.entries(currentTestCases).forEach(([category, tests]) => {
                if (tests.length === 0) return;
                
                code += `\n  describe('${formatCategoryName(category)}', () => {\n`;
                
                tests.forEach(test => {
                    code += `    test('${test.description}', () => {\n`;
                    code += `      // ${test.type}: ${test.selector || test.path}\n`;
                    
                    switch (test.type) {
                        case 'element_exists':
                            code += `      expect(screen.getByRole('${test.tagName}') || screen.getByTestId('${test.selector}')).toBeInTheDocument();\n`;
                            break;
                        case 'text_content':
                            code += `      expect(screen.getByText('${test.expectedText}')).toBeInTheDocument();\n`;
                            break;
                        case 'css_class':
                            code += `      expect(document.querySelector('${test.selector}')).toHaveClass('${test.expectedValue}');\n`;
                            break;
                        case 'children_count':
                            code += `      expect(document.querySelector('${test.selector}').children).toHaveLength(${test.expectedCount});\n`;
                            break;
                        default:
                            code += `      // TODO: Implement test for ${test.type}\n`;
                    }
                    
                    code += `    });\n\n`;
                });
                
                code += `  });\n`;
            });
            
            code += `});`;
            return code;
        }

        function generateCypressTests() {
            let code = `// Cypress Test Suite Generated by Juris Test Discovery
describe('Juris Application Tests', () => {
  beforeEach(() => {
    cy.visit('/'); // Adjust URL as needed
  });

`;

            Object.entries(currentTestCases).forEach(([category, tests]) => {
                if (tests.length === 0) return;
                
                code += `  context('${formatCategoryName(category)}', () => {\n`;
                
                tests.forEach(test => {
                    code += `    it('${test.description}', () => {\n`;
                    
                    switch (test.type) {
                        case 'element_exists':
                            code += `      cy.get('${test.selector}').should('exist');\n`;
                            break;
                        case 'text_content':
                            code += `      cy.contains('${test.expectedText}').should('be.visible');\n`;
                            break;
                        case 'css_class':
                            code += `      cy.get('${test.selector}').should('have.class', '${test.expectedValue}');\n`;
                            break;
                        case 'event_handler':
                            code += `      cy.get('${test.selector}').click();\n`;
                            code += `      // TODO: Add assertions for ${test.eventType} event\n`;
                            break;
                        case 'children_count':
                            code += `      cy.get('${test.selector}').children().should('have.length', ${test.expectedCount});\n`;
                            break;
                        default:
                            code += `      // TODO: Implement test for ${test.type}\n`;
                    }
                    
                    code += `    });\n\n`;
                });
                
                code += `  });\n`;
            });
            
            code += `});`;
            return code;
        }

        function generatePlaywrightTests() {
            let code = `// Playwright Test Suite Generated by Juris Test Discovery
import { test, expect } from '@playwright/test';

test.describe('Juris Application Tests', () => {
`;

            Object.entries(currentTestCases).forEach(([category, tests]) => {
                if (tests.length === 0) return;
                
                code += `\n  test.describe('${formatCategoryName(category)}', () => {\n`;
                
                tests.forEach(test => {
                    code += `    test('${test.description}', async ({ page }) => {\n`;
                    code += `      await page.goto('/'); // Adjust URL as needed\n`;
                    
                    switch (test.type) {
                        case 'element_exists':
                            code += `      await expect(page.locator('${test.selector}')).toBeVisible();\n`;
                            break;
                        case 'text_content':
                            code += `      await expect(page.getByText('${test.expectedText}')).toBeVisible();\n`;
                            break;
                        case 'css_class':
                            code += `      await expect(page.locator('${test.selector}')).toHaveClass(/${test.expectedValue}/);\n`;
                            break;
                        case 'event_handler':
                            code += `      await page.locator('${test.selector}').click();\n`;
                            code += `      // TODO: Add assertions for ${test.eventType} event\n`;
                            break;
                        case 'children_count':
                            code += `      await expect(page.locator('${test.selector} > *')).toHaveCount(${test.expectedCount});\n`;
                            break;
                        default:
                            code += `      // TODO: Implement test for ${test.type}\n`;
                    }
                    
                    code += `    });\n\n`;
                });
                
                code += `  });\n`;
            });
            
            code += `});`;
            return code;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = `
                <p style="text-align: center; color: #7f8c8d; font-style: italic;">
                    Click "Discover Tests" to analyze your Juris layout and generate test cases.
                </p>
            `;
            document.getElementById('stats').style.display = 'none';
            currentJuris = null;
            currentTestCases = null;
        }

        function showError(message) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = `<div class="error">${message}</div>` + resultsContainer.innerHTML;
        }

        function showSuccess(message) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = `<div class="success">${message}</div>` + resultsContainer.innerHTML;
        }
    </script>
</body>
</html>