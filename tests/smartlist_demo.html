<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris SmartList Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .demo-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }

        .demo-section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .todo-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .todo-item.done {
            opacity: 0.7;
            border-left-color: #48bb78;
        }

        .todo-item.done span {
            text-decoration: line-through;
        }

        .todo-item input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .user-card {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .user-card img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            border: 3px solid #667eea;
        }

        .user-card h3 {
            margin: 0 0 5px 0;
            color: #2d3748;
        }

        .user-card p {
            margin: 0;
            color: #718096;
            font-size: 14px;
        }

        .status-online {
            color: #48bb78 !important;
            font-weight: bold;
        }

        .status-offline {
            color: #f56565 !important;
        }

        .number-item {
            display: inline-block;
            padding: 10px 15px;
            margin: 5px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .number-item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #718096;
            font-style: italic;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px dashed #cbd5e0;
        }

        .performance-stats {
            background: #2d3748;
            color: white;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        input[type="text"], input[type="number"] {
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
        }

        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .demo-info {
            background: #edf2f7;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>üöÄ Juris SmartList Demo</h1>
        
        <div class="demo-section">
            <h2>üìù Todo List with Key-based Diffing</h2>
            <div class="demo-info">
                <strong>Key Feature:</strong> Uses stable IDs as keys for efficient DOM reuse. Try reordering, adding, and removing items to see minimal DOM manipulation.
            </div>
            <div class="controls">
                <div class="input-group">
                    <input type="text" id="todoInput" placeholder="Enter new todo..." />
                    <button onclick="addTodo()">Add Todo</button>
                </div>
                <button onclick="shuffleTodos()">üîÄ Shuffle</button>
                <button onclick="clearCompleted()">üóëÔ∏è Clear Completed</button>
                <button onclick="addBulkTodos()">‚ö° Add 100 Todos</button>
            </div>
            <div id="todoContainer"></div>
        </div>

        <div class="demo-section">
            <h2>üë• User List with Reactive Status</h2>
            <div class="demo-info">
                <strong>Key Feature:</strong> Demonstrates reactive updates within list items. User status changes update without re-rendering the entire list.
            </div>
            <div class="controls">
                <button onclick="addRandomUser()">üë§ Add Random User</button>
                <button onclick="toggleAllStatus()">üîÑ Toggle All Status</button>
                <button onclick="removeRandomUser()">‚ùå Remove Random User</button>
            </div>
            <div id="userContainer"></div>
        </div>

        <div class="demo-section">
            <h2>üî¢ Number List with Index-based For Loop</h2>
            <div class="demo-info">
                <strong>Key Feature:</strong> Shows the simpler For component for basic arrays. Click numbers to remove them.
            </div>
            <div class="controls">
                <div class="input-group">
                    <input type="number" id="numberInput" placeholder="Enter number..." />
                    <button onclick="addNumber()">Add Number</button>
                </div>
                <button onclick="addRandomNumbers()">üé≤ Add Random Numbers</button>
                <button onclick="clearNumbers()">üßπ Clear All</button>
                <button onclick="sortNumbers()">üìä Sort</button>
            </div>
            <div id="numberContainer"></div>
        </div>

        <div class="performance-stats" id="performanceStats">
            Performance Stats: Waiting for interactions...
        </div>
    </div>

    <script src="../src/juris.js"></script>
    <script src="../juris-ui/iterators/For.js"></script>
    <script>
        // Make functions global for HTML onclick handlers
        window.addTodo = function() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            if (text) {
                const todos = juris.getState('todos', []);
                const nextId = juris.getState('nextTodoId', 1);
                const newTodos = [...todos, { id: nextId, text, done: false }];
                juris.setState('todos', newTodos);
                juris.setState('nextTodoId', nextId + 1);
                input.value = '';
                updatePerformanceStats('Add todo');
            }
        };

        window.shuffleTodos = function() {
            const todos = juris.getState('todos', []);
            const shuffled = [...todos].sort(() => Math.random() - 0.5);
            juris.setState('todos', shuffled);
            updatePerformanceStats('Shuffle todos');
        };

        window.clearCompleted = function() {
            const todos = juris.getState('todos', []);
            const remaining = todos.filter(t => !t.done);
            juris.setState('todos', remaining);
            updatePerformanceStats('Clear completed todos');
        };

        window.addBulkTodos = function() {
            const todos = juris.getState('todos', []);
            let nextId = juris.getState('nextTodoId', 1);
            const newTodos = [];
            
            for (let i = 0; i < 100; i++) {
                newTodos.push({
                    id: nextId++,
                    text: `Bulk todo item ${i + 1}`,
                    done: Math.random() > 0.7
                });
            }
            
            juris.setState('todos', [...todos, ...newTodos]);
            juris.setState('nextTodoId', nextId);
            updatePerformanceStats('Add 100 todos');
        };

        window.addRandomUser = function() {
            const users = juris.getState('users', []);
            const nextId = juris.getState('nextUserId', 1);
            const names = ['David Chen', 'Emma Brown', 'Frank Wilson', 'Grace Lee', 'Henry Davis', 'Ivy Zhang', 'Jack Thompson'];
            const randomName = names[Math.floor(Math.random() * names.length)];
            
            const newUser = {
                id: nextId,
                name: randomName,
                avatar: `https://ui-avatars.io/api/?name=${encodeURIComponent(randomName)}&background=${Math.floor(Math.random()*16777215).toString(16)}&color=fff`,
                status: Math.random() > 0.5 ? 'online' : 'offline'
            };
            
            juris.setState('users', [...users, newUser]);
            juris.setState('nextUserId', nextId + 1);
            updatePerformanceStats('Add user');
        };

        window.removeRandomUser = function() {
            const users = juris.getState('users', []);
            if (users.length > 0) {
                const randomIndex = Math.floor(Math.random() * users.length);
                const newUsers = users.filter((_, index) => index !== randomIndex);
                juris.setState('users', newUsers);
                updatePerformanceStats('Remove user');
            }
        };

        window.toggleAllStatus = function() {
            const users = juris.getState('users', []);
            const allOnline = users.every(u => u.status === 'online');
            const newStatus = allOnline ? 'offline' : 'online';
            const updatedUsers = users.map(u => ({...u, status: newStatus}));
            juris.setState('users', updatedUsers);
            updatePerformanceStats('Toggle all user status');
        };

        window.addNumber = function() {
            const input = document.getElementById('numberInput');
            const number = parseInt(input.value);
            if (!isNaN(number)) {
                const numbers = juris.getState('numbers', []);
                juris.setState('numbers', [...numbers, number]);
                input.value = '';
                updatePerformanceStats('Add number');
            }
        };

        window.addRandomNumbers = function() {
            const numbers = juris.getState('numbers', []);
            const newNumbers = [];
            for (let i = 0; i < 10; i++) {
                newNumbers.push(Math.floor(Math.random() * 100) + 1);
            }
            juris.setState('numbers', [...numbers, ...newNumbers]);
            updatePerformanceStats('Add random numbers');
        };

        window.clearNumbers = function() {
            juris.setState('numbers', []);
            updatePerformanceStats('Clear numbers');
        };

        window.sortNumbers = function() {
            const numbers = juris.getState('numbers', []);
            const sorted = [...numbers].sort((a, b) => a - b);
            juris.setState('numbers', sorted);
            updatePerformanceStats('Sort numbers');
        };

        // Initialize Juris
        const juris = new Juris({
            logLevel: 'info',
            states: {
                todos: [
                    { id: 1, text: 'Learn Juris SmartList', done: false },
                    { id: 2, text: 'Build efficient lists', done: true },
                    { id: 3, text: 'Test key-based diffing', done: false }
                ],
                users: [
                    { id: 1, name: 'Alice Johnson', avatar: 'https://ui-avatars.io/api/?name=Alice+Johnson&background=667eea&color=fff', status: 'online' },
                    { id: 2, name: 'Bob Smith', avatar: 'https://ui-avatars.io/api/?name=Bob+Smith&background=764ba2&color=fff', status: 'offline' },
                    { id: 3, name: 'Carol Williams', avatar: 'https://ui-avatars.io/api/?name=Carol+Williams&background=48bb78&color=fff', status: 'online' }
                ],
                numbers: [1, 2, 3, 4, 5],
                nextTodoId: 4,
                nextUserId: 4,
                performanceData: {
                    todoOperations: 0,
                    userOperations: 0,
                    numberOperations: 0,
                    lastOperation: '',
                    startTime: Date.now()
                }
            }
        });

        // Register SmartList and For components
        juris.registerComponent('SmartList', SmartList);
        juris.registerComponent('For', For);

        // Todo List Component
        const TodoList = (props, context) => {
            const todos = () => context.getState('todos', []);

            return {
                SmartList: {
                    items: todos,
                    keyFn: (todo) => todo.id,
                    renderItem: (todo, index) => ({
                        div: {
                            class: `todo-item ${todo.done ? 'done' : ''}`,
                            'data-todo-id': todo.id,
                            children: [
                                {
                                    input: {
                                        type: 'checkbox',
                                        checked: todo.done,
                                        onchange: (e) => {
                                            const newTodos = todos().map(t => 
                                                t.id === todo.id ? {...t, done: e.target.checked} : t
                                            );
                                            context.setState('todos', newTodos);
                                            updatePerformanceStats('Toggle todo');
                                        }
                                    }
                                },
                                {
                                    span: {
                                        text: todo.text,
                                        style: { flex: '1' }
                                    }
                                },
                                {
                                    button: {
                                        text: '‚ùå',
                                        style: { 
                                            background: 'transparent', 
                                            border: 'none', 
                                            cursor: 'pointer',
                                            fontSize: '14px'
                                        },
                                        onclick: () => {
                                            const newTodos = todos().filter(t => t.id !== todo.id);
                                            context.setState('todos', newTodos);
                                            updatePerformanceStats('Remove todo');
                                        }
                                    }
                                }
                            ]
                        }
                    }),
                    placeholder: {
                        div: {
                            text: 'No todos yet! Add one above.',
                            class: 'empty-state'
                        }
                    }
                }
            };
        };

        // User List Component
        const UserList = (props, context) => {
            return {
                SmartList: {
                    items: () => context.getState('users', []),
                    keyFn: (user) => user.id,
                    renderItem: (user, index) => ({
                        div: {
                            class: 'user-card',
                            'data-user-id': user.id,
                            children: [
                                {img: {src: user.avatar, alt: user.name}},
                                {
                                    div: {
                                        children: [
                                            {h3: {text: user.name}},
                                            {
                                                p: {
                                                    text: () => `Status: ${context.getState(`users.${user.id}.status`, user.status)}`,
                                                    class: () => {
                                                        const status = context.getState(`users.${user.id}.status`, user.status);
                                                        return status === 'online' ? 'status-online' : 'status-offline';
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                {
                                    button: {
                                        text: () => {
                                            const status = context.getState(`users.${user.id}.status`, user.status);
                                            return status === 'online' ? 'üü¢ Online' : 'üî¥ Offline';
                                        },
                                        onclick: () => {
                                            const users = context.getState('users', []);
                                            const updatedUsers = users.map(u => {
                                                if (u.id === user.id) {
                                                    return {...u, status: u.status === 'online' ? 'offline' : 'online'};
                                                }
                                                return u;
                                            });
                                            context.setState('users', updatedUsers);
                                            updatePerformanceStats('Toggle user status');
                                        }
                                    }
                                }
                            ]
                        }
                    }),
                    placeholder: {
                        div: {
                            text: 'No users found.',
                            class: 'empty-state'
                        }
                    }
                }
            };
        };

        // Number List Component (using For)
        const NumberList = (props, context) => {
            const numbers = () => context.getState('numbers', []);

            return {
                For: {
                    each: numbers,
                    children: (num, index) => ({
                        div: {
                            class: 'number-item',
                            text: `${num} (index: ${index})`,
                            onclick: () => {
                                const newNumbers = numbers().filter(n => n !== num);
                                context.setState('numbers', newNumbers);
                                updatePerformanceStats('Remove number');
                            }
                        }
                    }),
                    fallback: {
                        div: {
                            text: 'No numbers! Add some above.',
                            class: 'empty-state'
                        }
                    }
                }
            };
        };

        // Register components
        juris.registerComponent('TodoList', TodoList);
        juris.registerComponent('UserList', UserList);
        juris.registerComponent('NumberList', NumberList);

        // Performance tracking
        function updatePerformanceStats(operation) {
            const current = juris.getState('performanceData');
            const newData = {
                ...current,
                lastOperation: operation,
                [`${operation.includes('todo') ? 'todo' : operation.includes('user') ? 'user' : 'number'}Operations`]: 
                    current[`${operation.includes('todo') ? 'todo' : operation.includes('user') ? 'user' : 'number'}Operations`] + 1
            };
            juris.setState('performanceData', newData);
            
            const stats = document.getElementById('performanceStats');
            const elapsed = ((Date.now() - current.startTime) / 1000).toFixed(1);
            stats.textContent = `Last: ${operation} | Todo ops: ${newData.todoOperations} | User ops: ${newData.userOperations} | Number ops: ${newData.numberOperations} | Runtime: ${elapsed}s`;
        }

        // Helper functions

        // Handle Enter key for inputs
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('todoInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTodo();
            });
            
            document.getElementById('numberInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addNumber();
            });
        });

        // Set up the layout and render
        juris.layout = {
            div: {
                children: [
                    { TodoList: {} },
                    { UserList: {} },
                    { NumberList: {} }
                ]
            }
        };

        // Render into specific containers
        setTimeout(() => {
            const todoContainer = document.getElementById('todoContainer');
            const userContainer = document.getElementById('userContainer');
            const numberContainer = document.getElementById('numberContainer');

            const todoElement = juris.objectToHtml({ TodoList: {} });
            const userElement = juris.objectToHtml({ UserList: {} });
            const numberElement = juris.objectToHtml({ NumberList: {} });

            if (todoElement) todoContainer.appendChild(todoElement);
            if (userElement) userContainer.appendChild(userElement);
            if (numberElement) numberContainer.appendChild(numberElement);

            updatePerformanceStats('Initial render');
        }, 100);
    </script>
</body>
</html>