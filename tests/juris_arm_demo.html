<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris ARM API Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            padding: 30px;
        }

        .demo-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .demo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .demo-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-card .icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .interactive-area {
            background: #f8fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .interactive-area:hover {
            background: #e2e8f0;
            border-color: #667eea;
        }

        .interactive-area.active {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        .status-display {
            background: #1a202c;
            color: #68d391;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 15px 0;
            max-height: 150px;
            overflow-y: auto;
        }

        .button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .button:active {
            transform: scale(0.95);
        }

        .global-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }

        .mouse-tracker {
            position: fixed;
            top: 0;
            left: 0;
            width: 20px;
            height: 20px;
            background: rgba(102, 126, 234, 0.7);
            border-radius: 50%;
            pointer-events: none;
            transition: transform 0.1s ease;
            z-index: 999;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .pulse {
            animation: pulse 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="mouse-tracker" id="mouseTracker"></div>
    
    <div class="global-status" id="globalStatus">
        <div>üåê Global Events Active</div>
        <div>Mouse: <span id="mousePos">0, 0</span></div>
        <div>Key: <span id="lastKey">none</span></div>
        <div>Custom Events: <span id="customCount">0</span></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üöÄ Juris ARM API Demo</h1>
            <p>Advanced Reactive Management - Event handling with context access</p>
        </div>

        <div class="demo-grid">
            <!-- Window ARM Demo -->
            <div class="demo-card">
                <h3><span class="icon">üåê</span>Window ARM Events</h3>
                <p>Global window events armed with Juris context</p>
                <div class="status-display" id="windowEvents">
                    Press any key or resize window...
                </div>
                <button class="button" onclick="triggerCustomEvent()">Trigger Custom Event</button>
            </div>

            <!-- Element ARM Demo -->
            <div class="demo-card">
                <h3><span class="icon">üéØ</span>Element ARM Events</h3>
                <p>Click, hover, and interact with armed elements</p>
                <div class="interactive-area" id="clickArea">
                    Click me! I'm armed with Juris events
                </div>
                <div class="status-display" id="elementEvents">
                    Clicks: 0 | Hovers: 0
                </div>
            </div>

            <!-- Body ARM Demo -->
            <div class="demo-card">
                <h3><span class="icon">üì±</span>Body ARM Events</h3>
                <p>Document body events with context integration</p>
                <div class="interactive-area" id="dragArea">
                    Drag your mouse here
                </div>
                <div class="status-display" id="bodyEvents">
                    Mouse movements tracked...
                </div>
            </div>

            <!-- State Integration -->
            <div class="demo-card">
                <h3><span class="icon">üîó</span>State Integration</h3>
                <p>ARM events updating Juris state reactively</p>
                <div class="status-display" id="stateDisplay">
                    State will update here...
                </div>
                <button class="button" onclick="resetState()">Reset State</button>
                <button class="button" onclick="toggleMode()">Toggle Mode</button>
            </div>

            <!-- Advanced Features -->
            <div class="demo-card">
                <h3><span class="icon">‚ö°</span>Advanced ARM</h3>
                <p>Custom events and complex interactions</p>
                <div class="interactive-area" id="advancedArea">
                    Advanced interaction zone
                </div>
                <div class="status-display" id="advancedEvents">
                    Advanced events logged here...
                </div>
            </div>

            <!-- Performance Monitor -->
            <div class="demo-card">
                <h3><span class="icon">üìä</span>Performance</h3>
                <p>ARM API performance and cleanup monitoring</p>
                <div class="status-display" id="performanceDisplay">
                    Performance metrics...
                </div>
                <button class="button" onclick="cleanupDemo()">Cleanup Demo</button>
                <button class="button" onclick="restartDemo()">Restart Demo</button>
            </div>
        </div>
    </div>

    <script src="../src/juris.js"></script>
    <script>
        // Initialize Juris instance
        const juris = new Juris({
            states: {
                mouse: { x: 0, y: 0 },
                clicks: 0,
                hovers: 0,
                keys: [],
                customEvents: 0,
                mode: 'normal',
                performance: { armedElements: 0 }
            },
            logLevel: 'info'
        });

        // Store unsubscribe functions
        let armCleanupFunctions = [];

        // Update displays based on state changes
        juris.subscribe('mouse', (newValue) => {
            document.getElementById('mousePos').textContent = `${newValue.x}, ${newValue.y}`;
            const tracker = document.getElementById('mouseTracker');
            tracker.style.transform = `translate(${newValue.x - 10}px, ${newValue.y - 10}px)`;
        });

        juris.subscribe('clicks', (newValue) => {
            updateElementDisplay();
        });

        juris.subscribe('hovers', (newValue) => {
            updateElementDisplay();
        });

        juris.subscribe('keys', (newValue) => {
            document.getElementById('lastKey').textContent = newValue[newValue.length - 1] || 'none';
            addToWindowEvents(`Key pressed: ${newValue[newValue.length - 1]}`);
        });

        juris.subscribe('customEvents', (newValue) => {
            document.getElementById('customCount').textContent = newValue;
        });

        juris.subscribe('mode', (newValue) => {
            updateStateDisplay();
        });

        // ARM Window Events
        const windowUnsubscribe = juris.arm(window, (context) => {
            return {
                onkeydown: (e) => {
                    const keys = context.getState('keys', []);
                    context.setState('keys', [...keys.slice(-9), e.key]);
                    
                    // Special key handling
                    if (e.key === 'Escape') {
                        context.setState('mode', 'escape');
                        setTimeout(() => context.setState('mode', 'normal'), 1000);
                    }
                },
                onresize: (e) => {
                    addToWindowEvents(`Window resized: ${window.innerWidth}x${window.innerHeight}`);
                },
                onNetflixResponse: (e) => {
                    const count = context.getState('customEvents', 0);
                    context.setState('customEvents', count + 1);
                    addToWindowEvents(`Custom Netflix event received: ${JSON.stringify(e.detail)}`);
                }
            };
        });
        armCleanupFunctions.push(windowUnsubscribe);

        // ARM Body Events  
        const bodyUnsubscribe = juris.arm(document.body, (context) => {
            return {
                onmousemove: (e) => {
                    context.setState('mouse.x', e.clientX);
                    context.setState('mouse.y', e.clientY);
                },
                onmouseleave: (e) => {
                    addToBodyEvents('Mouse left the body');
                },
                oncontextmenu: (e) => {
                    e.preventDefault();
                    addToBodyEvents('Right-click detected');
                }
            };
        });
        armCleanupFunctions.push(bodyUnsubscribe);

        // ARM Click Area Element
        const clickArea = document.getElementById('clickArea');
        const clickUnsubscribe = juris.arm(clickArea, (context) => {
            return {
                onclick: (e) => {
                    const clicks = context.getState('clicks', 0);
                    context.setState('clicks', clicks + 1);
                    
                    clickArea.classList.add('pulse');
                    setTimeout(() => clickArea.classList.remove('pulse'), 300);
                },
                onmouseenter: (e) => {
                    const hovers = context.getState('hovers', 0);
                    context.setState('hovers', hovers + 1);
                    clickArea.classList.add('active');
                },
                onmouseleave: (e) => {
                    clickArea.classList.remove('active');
                },
                ondblclick: (e) => {
                    context.setState('clicks', 0);
                    context.setState('hovers', 0);
                    addToElementEvents('Double-click reset!');
                }
            };
        });
        armCleanupFunctions.push(clickUnsubscribe);

        // ARM Advanced Area
        const advancedArea = document.getElementById('advancedArea');
        const advancedUnsubscribe = juris.arm(advancedArea, (context) => {
            return {
                onmousedown: (e) => {
                    addToAdvancedEvents(`Mouse down at: ${e.offsetX}, ${e.offsetY}`);
                    advancedArea.style.background = '#667eea';
                },
                onmouseup: (e) => {
                    addToAdvancedEvents('Mouse released');
                    advancedArea.style.background = '#f8fafc';
                },
                onwheel: (e) => {
                    e.preventDefault();
                    const direction = e.deltaY > 0 ? 'down' : 'up';
                    addToAdvancedEvents(`Wheel scrolled ${direction}`);
                },
                onDataReceived: (e) => {
                    addToAdvancedEvents(`Custom data: ${JSON.stringify(e.detail)}`);
                }
            };
        });
        armCleanupFunctions.push(advancedUnsubscribe);

        // Helper functions for updating displays
        function addToWindowEvents(message) {
            const display = document.getElementById('windowEvents');
            const lines = display.textContent.split('\n');
            lines.push(`${new Date().toLocaleTimeString()}: ${message}`);
            if (lines.length > 5) lines.shift();
            display.textContent = lines.join('\n');
        }

        function addToBodyEvents(message) {
            const display = document.getElementById('bodyEvents');
            const lines = display.textContent.split('\n');
            lines.push(`${new Date().toLocaleTimeString()}: ${message}`);
            if (lines.length > 5) lines.shift();
            display.textContent = lines.join('\n');
        }

        function addToElementEvents(message) {
            const display = document.getElementById('elementEvents');
            const currentText = display.textContent;
            if (!currentText.includes('Clicks:')) {
                display.textContent = '';
            }
            display.textContent += `\n${new Date().toLocaleTimeString()}: ${message}`;
        }

        function addToAdvancedEvents(message) {
            const display = document.getElementById('advancedEvents');
            const lines = display.textContent.split('\n');
            lines.push(`${new Date().toLocaleTimeString()}: ${message}`);
            if (lines.length > 5) lines.shift();
            display.textContent = lines.join('\n');
        }

        function updateElementDisplay() {
            const clicks = juris.getState('clicks', 0);
            const hovers = juris.getState('hovers', 0);
            document.getElementById('elementEvents').textContent = `Clicks: ${clicks} | Hovers: ${hovers}`;
        }

        function updateStateDisplay() {
            const state = {
                mouse: juris.getState('mouse', {}),
                clicks: juris.getState('clicks', 0),
                hovers: juris.getState('hovers', 0),
                mode: juris.getState('mode', 'normal'),
                customEvents: juris.getState('customEvents', 0)
            };
            document.getElementById('stateDisplay').textContent = JSON.stringify(state, null, 2);
        }

        function updatePerformanceDisplay() {
            const stats = {
                armedElements: armCleanupFunctions.length,
                stateSubscriptions: Object.keys(juris.stateManager.externalSubscribers).length,
                currentMode: juris.getRenderMode()
            };
            document.getElementById('performanceDisplay').textContent = JSON.stringify(stats, null, 2);
        }

        // Demo control functions
        function triggerCustomEvent() {
            const event = new CustomEvent('NetflixResponse', {
                detail: { 
                    status: 'success', 
                    data: ['Movie 1', 'Movie 2', 'Movie 3'],
                    timestamp: Date.now()
                }
            });
            window.dispatchEvent(event);
        }

        function resetState() {
            juris.setState('clicks', 0);
            juris.setState('hovers', 0);
            juris.setState('keys', []);
            juris.setState('customEvents', 0);
            juris.setState('mode', 'normal');
            updateElementDisplay();
            updateStateDisplay();
        }

        function toggleMode() {
            const currentMode = juris.getState('mode', 'normal');
            const newMode = currentMode === 'normal' ? 'advanced' : 'normal';
            juris.setState('mode', newMode);
        }

        function cleanupDemo() {
            armCleanupFunctions.forEach(cleanup => cleanup());
            armCleanupFunctions = [];
            document.getElementById('performanceDisplay').textContent = 'All ARM events cleaned up!';
        }

        function restartDemo() {
            location.reload();
        }

        // Trigger a custom event on advanced area
        setInterval(() => {
            const event = new CustomEvent('DataReceived', {
                detail: { 
                    random: Math.random(),
                    timestamp: Date.now()
                }
            });
            advancedArea.dispatchEvent(event);
        }, 5000);

        // Initialize displays
        updateElementDisplay();
        updateStateDisplay();
        updatePerformanceDisplay();

        // Update performance display every second
        setInterval(updatePerformanceDisplay, 1000);
    </script>
</body>
</html>