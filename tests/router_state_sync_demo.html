<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris Router Demo - Pure Philosophy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .demo-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .demo-section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .control-group {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }
        
        .control-group h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #4a5568;
            font-weight: 500;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .button.secondary {
            background: #718096;
        }
        
        .button.danger {
            background: #e53e3e;
        }
        
        .state-display {
            background: #1a202c;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status-indicators {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-indicator {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
        }
        
        .status-indicator.active {
            background: #c6f6d5;
            border-color: #68d391;
            color: #22543d;
        }
        
        .url-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 20px;
            word-break: break-all;
        }
        
        .route-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .highlight {
            background: #e6fffa;
            border: 1px solid #4fd1c7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .highlight h4 {
            color: #234e52;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .highlight p {
            color: #285e61;
            font-size: 14px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <!-- Load Juris Scripts -->
    <script src="../src/headless/juris-router.js"></script>
    <script src="../src/juris-headless.js"></script>
    <script src="../src/juris.js"></script>
    
    <script>
        // Pure Juris Router Demo - No Abstractions
        const RouterDemoApp = (props, context) => {
            const { getState, setState } = context;
            const router = context.juris.headlessAPIs.router;
            
            // Set up URL-State sync directly - pure Juris philosophy
            router.setURLStateSync(['product', 'user', 'cart']);
            
            return {
                div: {
                    class: 'container',
                    children: [
                        // Header
                        {
                            div: {
                                class: 'header',
                                children: [
                                    { h1: { text: '🧭 Pure Juris Router Demo' } },
                                    { p: { text: 'Pure Juris philosophy: components use standard getState/setState, router handles URL sync transparently!' } }
                                ]
                            }
                        },

                        // Highlight Box
                        {
                            div: {
                                class: 'highlight',
                                children: [
                                    { h4: { text: '✨ Pure Juris Philosophy' } },
                                    { p: { text: 'No wrapper functions, no abstractions. Components use normal getState/setState. Router automatically syncs state paths like "product.search" with URL query parameters like "?search=".' } }
                                ]
                            }
                        },

                        // Current URL Display
                        () => {
                            const currentUrl = router.getCurrentPath();
                            const query = router.getQuery();
                            const fullUrl = currentUrl + (Object.keys(query).length > 0 ? 
                                '?' + Object.entries(query).map(([k,v]) => `${k}=${encodeURIComponent(v)}`).join('&') : '');
                            
                            return {
                                div: {
                                    class: 'demo-section',
                                    children: [
                                        { h2: { text: 'Current URL' } },
                                        { div: { class: 'url-display', text: `${window.location.origin}${window.location.pathname}#${fullUrl}` } }
                                    ]
                                }
                            };
                        },

                        // Navigation Controls
                        {
                            div: {
                                class: 'demo-section',
                                children: [
                                    { h2: { text: 'Navigation Controls' } },
                                    {
                                        div: {
                                            class: 'route-buttons',
                                            children: [
                                                {
                                                    button: {
                                                        class: 'button',
                                                        text: 'Home',
                                                        onclick: () => router.navigate('/')
                                                    }
                                                },
                                                {
                                                    button: {
                                                        class: 'button',
                                                        text: 'Products',
                                                        onclick: () => router.navigate('/products')
                                                    }
                                                },
                                                {
                                                    button: {
                                                        class: 'button',
                                                        text: 'Profile',
                                                        onclick: () => router.navigate('/profile')
                                                    }
                                                },
                                                {
                                                    button: {
                                                        class: 'button secondary',
                                                        text: 'Clear Parameters',
                                                        onclick: () => {
                                                            const currentPath = router.getCurrentPath().split('?')[0];
                                                            router.navigate(currentPath);
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        },

                        // Form Controls with Pure Juris State Management
                        {
                            div: {
                                class: 'demo-section',
                                children: [
                                    { h2: { text: 'Pure Juris State Management' } },
                                    
                                    {
                                        div: {
                                            class: 'controls',
                                            children: [
                                                // Product Controls
                                                {
                                                    div: {
                                                        class: 'control-group',
                                                        children: [
                                                            { h3: { text: 'Product Search (product.*)' } },
                                                            {
                                                                div: {
                                                                    class: 'input-group',
                                                                    children: [
                                                                        { label: { text: 'Search Query (product.search → ?search=)' } },
                                                                        {
                                                                            input: {
                                                                                type: 'text',
                                                                                placeholder: 'Enter search term...',
                                                                                value: () => getState('product.search', ''),
                                                                                oninput: (e) => setState('product.search', e.target.value)
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            },
                                                            {
                                                                div: {
                                                                    class: 'input-group',
                                                                    children: [
                                                                        { label: { text: 'Category (product.category → ?category=)' } },
                                                                        {
                                                                            select: {
                                                                                value: () => getState('product.category', ''),
                                                                                onchange: (e) => setState('product.category', e.target.value),
                                                                                children: [
                                                                                    { option: { value: '', text: 'All Categories' } },
                                                                                    { option: { value: 'electronics', text: 'Electronics' } },
                                                                                    { option: { value: 'clothing', text: 'Clothing' } },
                                                                                    { option: { value: 'books', text: 'Books' } },
                                                                                    { option: { value: 'home', text: 'Home & Garden' } }
                                                                                ]
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            },
                                                            {
                                                                div: {
                                                                    class: 'input-group',
                                                                    children: [
                                                                        { label: { text: 'Max Price (product.maxPrice → ?maxPrice=)' } },
                                                                        {
                                                                            input: {
                                                                                type: 'range',
                                                                                min: '0',
                                                                                max: '1000',
                                                                                value: () => getState('product.maxPrice', 500),
                                                                                oninput: (e) => setState('product.maxPrice', parseInt(e.target.value))
                                                                            }
                                                                        },
                                                                        {
                                                                            div: {
                                                                                text: () => `Max: $${getState('product.maxPrice', 500)}`,
                                                                                style: { fontSize: '14px', color: '#718096', marginTop: '5px' }
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },

                                                // User Controls
                                                {
                                                    div: {
                                                        class: 'control-group',
                                                        children: [
                                                            { h3: { text: 'User Preferences (user.*)' } },
                                                            {
                                                                div: {
                                                                    class: 'checkbox-group',
                                                                    children: [
                                                                        {
                                                                            input: {
                                                                                type: 'checkbox',
                                                                                id: 'darkMode',
                                                                                checked: () => getState('user.darkMode', false),
                                                                                onchange: (e) => setState('user.darkMode', e.target.checked)
                                                                            }
                                                                        },
                                                                        { label: { for: 'darkMode', text: 'Dark Mode (user.darkMode → ?darkMode=)' } }
                                                                    ]
                                                                }
                                                            },
                                                            {
                                                                div: {
                                                                    class: 'checkbox-group',
                                                                    children: [
                                                                        {
                                                                            input: {
                                                                                type: 'checkbox',
                                                                                id: 'notifications',
                                                                                checked: () => getState('user.notifications', true),
                                                                                onchange: (e) => setState('user.notifications', e.target.checked)
                                                                            }
                                                                        },
                                                                        { label: { for: 'notifications', text: 'Notifications (user.notifications → ?notifications=)' } }
                                                                    ]
                                                                }
                                                            },
                                                            {
                                                                div: {
                                                                    class: 'input-group',
                                                                    children: [
                                                                        { label: { text: 'Items per Page (user.pageSize → ?pageSize=)' } },
                                                                        {
                                                                            select: {
                                                                                value: () => getState('user.pageSize', 20),
                                                                                onchange: (e) => setState('user.pageSize', parseInt(e.target.value)),
                                                                                children: [
                                                                                    { option: { value: '10', text: '10 items' } },
                                                                                    { option: { value: '20', text: '20 items' } },
                                                                                    { option: { value: '50', text: '50 items' } },
                                                                                    { option: { value: '100', text: '100 items' } }
                                                                                ]
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            },
                                                            {
                                                                div: {
                                                                    class: 'input-group',
                                                                    children: [
                                                                        { label: { text: 'User ID (user.userId → ?userId=)' } },
                                                                        {
                                                                            input: {
                                                                                type: 'text',
                                                                                placeholder: 'Enter user ID...',
                                                                                value: () => getState('user.userId', ''),
                                                                                oninput: (e) => setState('user.userId', e.target.value)
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            },
                                                            
                                                            // Test object serialization
                                                            {
                                                                div: {
                                                                    style: { marginTop: '20px', padding: '15px', background: '#fff3cd', borderRadius: '8px', border: '1px solid #ffeaa7' },
                                                                    children: [
                                                                        { h4: { text: 'Object Serialization Test', style: { color: '#b7950b', marginBottom: '10px' } } },
                                                                        {
                                                                            button: {
                                                                                class: 'button secondary',
                                                                                text: 'Set Object to user.preferences',
                                                                                onclick: () => setState('user.preferences', { 
                                                                                    theme: 'dark', 
                                                                                    language: 'en',
                                                                                    settings: { autoSave: true, notifications: false }
                                                                                }),
                                                                                style: { fontSize: '12px', padding: '8px 12px' }
                                                                            }
                                                                        },
                                                                        {
                                                                            div: {
                                                                                text: () => {
                                                                                    const prefs = getState('user.preferences', null);
                                                                                    return prefs ? `Current: ${JSON.stringify(prefs)}` : 'No preferences set';
                                                                                },
                                                                                style: { fontSize: '12px', marginTop: '8px', color: '#856404' }
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        },

                        // Router Status
                        () => {
                            const syncStatus = router.getQuerySyncStatus();
                            
                            return {
                                div: {
                                    class: 'demo-section',
                                    children: [
                                        { h2: { text: 'Router Status' } },
                                        {
                                            div: {
                                                class: 'status-indicators',
                                                children: [
                                                    {
                                                        div: {
                                                            class: `status-indicator ${syncStatus.enabled ? 'active' : ''}`,
                                                            text: `URL Sync: ${syncStatus.enabled ? 'Active' : 'Disabled'}`
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            class: `status-indicator ${syncStatus.syncedPaths.length > 0 ? 'active' : ''}`,
                                                            text: `Synced Paths: ${syncStatus.syncedPaths.join(', ') || 'None'}`
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            class: `status-indicator ${syncStatus.isUpdatingFromUrl ? 'active' : ''}`,
                                                            text: `URL → State: ${syncStatus.isUpdatingFromUrl ? 'Syncing' : 'Idle'}`
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            class: `status-indicator ${syncStatus.isUpdatingFromState ? 'active' : ''}`,
                                                            text: `State → URL: ${syncStatus.isUpdatingFromState ? 'Syncing' : 'Idle'}`
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            };
                        },

                        // State Debug View
                        () => {
                            const urlState = router.getState ? router.getState() : { path: router.getCurrentPath(), query: router.getQuery() };
                            const queryParams = router.getQuery();
                            
                            const debugData = {
                                currentPath: router.getCurrentPath(),
                                queryParameters: queryParams,
                                urlState: urlState,
                                syncedStatePaths: router.getQuerySyncStatus().syncedPaths,
                                stateValues: {
                                    'product.search': getState('product.search', ''),
                                    'product.category': getState('product.category', ''),
                                    'product.maxPrice': getState('product.maxPrice', 500),
                                    'user.darkMode': getState('user.darkMode', false),
                                    'user.notifications': getState('user.notifications', true),
                                    'user.pageSize': getState('user.pageSize', 20),
                                    'user.userId': getState('user.userId', '')
                                },
                                timestamp: new Date().toISOString()
                            };
                            
                            return {
                                div: {
                                    class: 'demo-section',
                                    children: [
                                        { h2: { text: 'Debug Information' } },
                                        { div: { class: 'state-display', text: JSON.stringify(debugData, null, 2) } }
                                    ]
                                }
                            };
                        }
                    ]
                }
            };
        };

        // Initialize Juris with Router
        const juris = new Juris({
            logLevel: 'info',
            features: {
                headless: HeadlessManager
            },
            headlessComponents: {
                router: {
                    fn: Router,
                    options: {
                        autoInit: true,
                        config: {
                            debug: true,
                            mode: 'hash',
                            urlStateSync: {
                                enabled: true,
                                debounceMs: 100,
                                parseTypes: true,
                                encodeArrays: true,
                                excludeEmpty: true,
                                includeInHistory: false
                            },
                            routes: {
                                '/': { name: 'Home' },
                                '/products': { name: 'Products' },
                                '/profile': { name: 'Profile' },
                                '/404': { name: 'Not Found' }
                            },
                            defaultRoute: '/',
                            notFoundRoute: '/404'
                        }
                    }
                }
            },
            components: {
                RouterDemoApp
            },
            layout: { RouterDemoApp: {} }
        });

        // Log success
        setTimeout(() => {
            console.log('🚀 Pure Juris Router Demo initialized!');
            console.log('📍 Components use standard getState/setState');
            console.log('🔗 Router transparently syncs state with URL');
            console.log('✨ Pure Juris philosophy - no abstractions!');
        }, 100);

        // Render the app
        juris.render('#app');
    </script>
</body>
</html>